<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="JingFengJi">
<meta property="og:url" content="https://jingfengji.github.io/page/2/index.html">
<meta property="og:site_name" content="JingFengJi">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JingFengJi">






  <link rel="canonical" href="https://jingfengji.github.io/page/2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>JingFengJi</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JingFengJi</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/07/30/Unity编辑器拓展之十六：监听Scene Drag事件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/30/Unity编辑器拓展之十六：监听Scene Drag事件/" class="post-title-link" itemprop="url">Unity编辑器拓展之十六：监听Scene Drag事件</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-30 21:26:48" itemprop="dateCreated datePublished" datetime="2018-07-30T21:26:48+08:00">2018-07-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:36" itemprop="dateModified" datetime="2019-03-11T22:04:36+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/07/30/Unity编辑器拓展之十六：监听Scene Drag事件/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之十六：监听Scene Drag事件">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="监听Scene-Drag事件"><a href="#监听Scene-Drag事件" class="headerlink" title="监听Scene Drag事件"></a>监听Scene Drag事件</h1><h2 id="Gif动图展示"><a href="#Gif动图展示" class="headerlink" title="Gif动图展示"></a>Gif动图展示</h2><p><img src="https://img-blog.csdn.net/20180730212155553?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>通过该监听，获取到被Drag进Scene的物体的类型，可以做一些预处理，例如：Drag一张图片，直接生成一个GameObject（带Image，前提是UGUI）的放在Canvas下</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEditor;
public class SceneManager
{
    [InitializeOnLoadMethod]
    static void Init()
    {
        SceneView.onSceneGUIDelegate += OnSceneGUI;
    }

    private static void OnSceneGUI(SceneView sceneView)
    {
        Event e = Event.current;
        if(e.type == EventType.DragUpdated || e.type == EventType.DragPerform)
        {
            DragAndDrop.visualMode = DragAndDropVisualMode.Copy;
            if(e.type == EventType.DragPerform)
            {
                DragAndDrop.AcceptDrag();
                for (int i = 0; i &lt; DragAndDrop.objectReferences.Length; i++)
                {
                    Object handleObj = DragAndDrop.objectReferences[i];
                    if(handleObj != null)
                    {
                        Debug.LogError(handleObj.GetType());
                    }
                }
            }
        }
    }
}
</code></pre><p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/07/28/Unity编辑器拓展之十五：NGUI批量替换图集工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/28/Unity编辑器拓展之十五：NGUI批量替换图集工具/" class="post-title-link" itemprop="url">Unity编辑器拓展之十五：NGUI批量替换图集工具</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-28 02:18:07" itemprop="dateCreated datePublished" datetime="2018-07-28T02:18:07+08:00">2018-07-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:49" itemprop="dateModified" datetime="2019-03-11T22:04:49+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/07/28/Unity编辑器拓展之十五：NGUI批量替换图集工具/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之十五：NGUI批量替换图集工具">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="NGUI批量替换图集工具"><a href="#NGUI批量替换图集工具" class="headerlink" title="NGUI批量替换图集工具"></a>NGUI批量替换图集工具</h1><h2 id="工具目的"><a href="#工具目的" class="headerlink" title="工具目的"></a>工具目的</h2><p>因项目需要实现换肤的功能，也就是多套UI图集，提供工具批量换图集，方便查看Prebab各皮肤（图集）下的效果</p>
<h2 id="示意图"><a href="#示意图" class="headerlink" title="示意图"></a>示意图</h2><p>Gif 操作动图：<br><img src="https://img-blog.csdn.net/20180728004232812?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>工具截图：<br><img src="https://img-blog.csdn.net/20180728004352956?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>工具左侧是工程所有Prefab列表，右侧是替换图集的功能菜单，从指定原图集替换成目标图集</p>
<h2 id="逻辑"><a href="#逻辑" class="headerlink" title="逻辑"></a>逻辑</h2><p>与上文：Unity编辑器之十四：字体替换工具 <a href="https://blog.csdn.net/qq_26999509/article/details/81106083" target="_blank" rel="noopener">https://blog.csdn.net/qq_26999509/article/details/81106083</a><br>一样，其实找到Prebfab下所有UISprite，并将其所有指定原图集 替换成<br>指定的目标图集，以此实现换肤的功能，当然两图集的SpriteName应该保持一致，不然没办法知道要换成目标图集里的那张图。</p>
<h2 id="重点代码"><a href="#重点代码" class="headerlink" title="重点代码"></a>重点代码</h2><pre><code>private void ReplacePrefabAtalas(GameObject prefab , UIAtlas atlas,UIAtlas targetAtlas)
{
    if(prefab == null || atlas == null) return;
    UISprite[] sprites = prefab.GetComponentsInChildren&lt;UISprite&gt;(true);
    if(sprites != null &amp;&amp; sprites.Length &gt; 0)
    {
        int num = sprites.Length;
        for (int i = 0; i &lt; num; i++)
        {
            UISprite s = sprites[i];
            if(s != null &amp;&amp; s.atlas == atlas)
            {
                s.atlas = targetAtlas;
                EditorUtility.SetDirty(s);
            }
        }
    }
    AssetDatabase.SaveAssets();
}
</code></pre><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>1、Tools-&gt;ReplaceAtalas 打开工具</p>
<p><img src="https://img-blog.csdn.net/20180728005410396?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>2、选中待处理预制体，鼠标右键-&gt;替换图集</p>
<p><img src="https://img-blog.csdn.net/20180728005536617?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>3、<br><img src="https://img-blog.csdn.net/20180728005711218?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>4、 <img src="https://img-blog.csdn.net/20180728010026779?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h2 id="工具代码"><a href="#工具代码" class="headerlink" title="工具代码"></a>工具代码</h2><pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEditor;
using System.IO;
using UnityEditor.IMGUI.Controls;

public class ReplaceAtalas : EditorWindow 
{

    private static ReplaceAtalas window = null;
    private static List&lt;string&gt; prefabPathList = new List&lt;string&gt; ();
    private static string assetPath;

    Rect SearchFieldRect
    {
        get
        {
            return new Rect(interval,interval,position.width * 0.3f,20f);
        }
    }

    Rect prefabListRect 
    {
        get { return new Rect (interval, interval + SearchFieldRect.yMax, SearchFieldRect.width, window.position.height - SearchFieldRect.yMax - 2 * interval); }
    }

    Rect replaceAtalsRect
    {
        get{return new Rect(prefabListRect.xMax + interval,interval,window.position.width - SearchFieldRect.width - 3 * interval,window.position.height - 2 * interval);}
    }

    private Vector2 scrollWidgetPos;
    private float interval = 20f;
    private string searchStr = &quot;&quot;;
    private SearchField searchField;
    private bool initialized = false;

    [MenuItem(&quot;Assets/替换图集&quot;, false, 2001)]
    public static void OpenWindow()
    {
        string selectedAssetPath = AssetDatabase.GetAssetPath (Selection.activeObject);
        if(!string.IsNullOrEmpty(selectedAssetPath) &amp;&amp; selectedAssetPath.EndsWith(&quot;.prefab&quot;))
        {
            ReplaceAtalas window = ShowWindow();
            if(window != null)
            {
                window.AutoSelctPrefab(selectedAssetPath);
            }
        }
    }

    [MenuItem(&quot;Tools/ReplaceAtalas&quot;)]
    public static ReplaceAtalas ShowWindow() 
    {
        prefabPathList.Clear ();
        assetPath = Application.dataPath;
        GetFiles (new DirectoryInfo (assetPath), &quot;*.prefab&quot;, ref prefabPathList);
        if (window == null)
            window = EditorWindow.GetWindow(typeof(ReplaceAtalas)) as ReplaceAtalas;
        window.titleContent = new GUIContent(&quot;ReplaceAtalas&quot;);
        window.Show();
        return window;
    }

    public static void GetFiles (DirectoryInfo directory, string pattern, ref List&lt;string&gt; fileList) 
    {
        if (directory != null &amp;&amp; directory.Exists &amp;&amp; !string.IsNullOrEmpty (pattern)) {
            try {
                foreach (FileInfo info in directory.GetFiles (pattern)) {
                    string path = info.FullName.ToString ();
                    fileList.Add (path.Substring (path.IndexOf (&quot;Assets&quot;)));
                }
            } catch (System.Exception) 
            {
                throw;
            }
            foreach (DirectoryInfo info in directory.GetDirectories ()) 
            {
                GetFiles (info, pattern, ref fileList);
            }
        }
    }

    private void OnGUI() 
    {
        InitIfNeeded();
        DrawWindow();
    }

    private void DrawWindow()
    {
        DrawSearchField();
        DrawPrefabList();
        DrawReplaceAtalasTool();
    }

    private void InitIfNeeded()
    {
        if(!initialized)
        {
            if (null == searchField)
                searchField = new SearchField ();
        }
        initialized = true;
    }

    private void DrawSearchField()
    {
        GUI.backgroundColor = Color.white;
        searchStr = searchField.OnGUI (SearchFieldRect, searchStr);
        searchStr = searchStr.ToLower();
    }

    private void DrawPrefabList()
    {
        GUI.backgroundColor = Color.white;

        GUI.Box(prefabListRect,&quot;&quot;);
        GUILayout.BeginArea(prefabListRect);
        scrollWidgetPos = EditorGUILayout.BeginScrollView(scrollWidgetPos);
        for (int i = 0; i &lt; prefabPathList.Count; i++)
        {
            if(CheckShowPrefab(prefabPathList[i],searchStr))
            {
                if(GUILayout.Button(prefabPathList[i]))
                {
                    curReplacePrefabPath = prefabPathList[i];
                    curPrefabAtlas = GetPrefabAllAtlas(curReplacePrefabPath);
                }
            }
        }
        EditorGUILayout.EndScrollView();
        GUILayout.EndArea();
    }

    private string curReplacePrefabPath = &quot;&quot;;

    private bool CheckShowPrefab(string path,string searchstr)
    {
        if(string.IsNullOrEmpty(searchStr)) return true;
        if(string.IsNullOrEmpty(path)) return false;
        return GetFileNameWithSuffix(path.ToLower()).Contains(searchStr);
    }

    //包括后缀名
    private string GetFileNameWithSuffix(string path)
    {
        if(string.IsNullOrEmpty(path)) return string.Empty;
        return path.Substring(path.LastIndexOf(&quot;/&quot;)+1);
    }

    private UIAtlas curAtlas;
    private UIAtlas targetAtlas;

    void OnSelectAtlas (Object obj)
    {
        UIAtlas atlas = obj as UIAtlas;
        if(isSelectCurAtlas)
        {
            curAtlas = obj as UIAtlas;
        }
        else if(isSelectTargetAtlas)
        {
            targetAtlas = obj as UIAtlas;
        }
        isSelectCurAtlas = false;
        isSelectTargetAtlas = false;
    }

    private bool isSelectCurAtlas = false;
    private bool isSelectTargetAtlas = false;
    private List&lt;UIAtlas&gt; curPrefabAtlas = new List&lt;UIAtlas&gt;();
    private void DrawReplaceAtalasTool()
    {
        GUI.backgroundColor = Color.white;

        GUILayout.BeginArea(replaceAtalsRect);
        EditorGUILayout.LabelField(curReplacePrefabPath);

        GUILayout.BeginHorizontal();
        EditorGUILayout.LabelField(&quot;该预制体含有的所有图集:&quot;,GUILayout.Width(150));
        if(curPrefabAtlas.Count &gt; 0)
        {
            for (int i = 0; i &lt; curPrefabAtlas.Count; i++)
            {
                if(GUILayout.Button(curPrefabAtlas[i].name))
                {
                    curAtlas = curPrefabAtlas[i];
                }
                if(GUILayout.Button(&quot;Edit&quot;))
                {
                    //NGUISettings.atlas = mFont.atlas;
                    //NGUISettings.selectedSprite = sym.spriteName;
                    NGUIEditorTools.Select(curPrefabAtlas[i].gameObject);
                }
            }
        }
        GUILayout.EndHorizontal();

        //原图集
        GUILayout.BeginHorizontal();
        curAtlas = (UIAtlas)EditorGUILayout.ObjectField(&quot;被替换图集&quot;, curAtlas, typeof(UIAtlas), true);
        if (NGUIEditorTools.DrawPrefixButton(&quot;选择Atlas&quot;,GUILayout.Width(200)))
        {
            isSelectCurAtlas = true;
            ComponentSelector.Show&lt;UIAtlas&gt;(OnSelectAtlas);
        }
        GUILayout.EndHorizontal();

        //目标图集
        GUILayout.BeginHorizontal();
        targetAtlas = (UIAtlas)EditorGUILayout.ObjectField(&quot;目标图集&quot;, targetAtlas, typeof(UIAtlas), true);     

        if (NGUIEditorTools.DrawPrefixButton(&quot;选择Atlas&quot;,GUILayout.Width(200)))
        {
            isSelectTargetAtlas = true;
            ComponentSelector.Show&lt;UIAtlas&gt;(OnSelectAtlas);
        }
        GUILayout.EndHorizontal();

        if(GUILayout.Button(&quot;互换&quot;))
        {
            UIAtlas tmpCurAtlas = curAtlas;
            curAtlas = targetAtlas;
            targetAtlas = tmpCurAtlas;
        }

        //替换按钮
        if(GUILayout.Button(&quot;替换图集&quot;))
        {
            if(string.IsNullOrEmpty(curReplacePrefabPath))
            {
                EditorUtility.DisplayDialog(&quot;提示&quot;, &quot;请先选择一个预制体!&quot;, &quot;确定&quot;);
            }
            else if (curAtlas == null)
            {
                EditorUtility.DisplayDialog(&quot;提示&quot;, &quot;请先指定被替换图集!&quot;, &quot;确定&quot;);
            }
            else
            {
                if(targetAtlas == null)
                {
                    if(EditorUtility.DisplayDialog(&quot;提示&quot;, &quot;原图集将被清空，确定替换吗？&quot;, &quot;确定&quot;,&quot;取消&quot;))
                    {
                        ReplacePrefabAtalas(curReplacePrefabPath);
                    }
                }
                else
                {
                    ReplacePrefabAtalas(curReplacePrefabPath);
                }
            }
        }
        //保存按钮

        //撤销按钮

        GUILayout.EndArea();
    }

    private void ReplacePrefabAtalas(string path)
    {
        if(string.IsNullOrEmpty(path)) return;
        GameObject gameObj = AssetDatabase.LoadAssetAtPath&lt;GameObject&gt;(path);
        ReplacePrefabAtalas(gameObj,curAtlas,targetAtlas);
    }   

    private List&lt;UIAtlas&gt; GetPrefabAllAtlas(string path)
    {
        if(string.IsNullOrEmpty(path)) return null;
        GameObject gameObj = AssetDatabase.LoadAssetAtPath&lt;GameObject&gt;(path);
        return GetPrefabAllAtlas(gameObj);
    }

    private List&lt;UIAtlas&gt; GetPrefabAllAtlas(GameObject prefab)
    {
        if(null == prefab) return null;
        List&lt;UIAtlas&gt; atlass = new List&lt;UIAtlas&gt;();
        UISprite[] sprites = prefab.GetComponentsInChildren&lt;UISprite&gt;(true);
        if(sprites != null &amp;&amp; sprites.Length &gt; 0)
        {
            int num = sprites.Length;
            for (int i = 0; i &lt; num; i++)
            {
                UISprite s = sprites[i];
                if(s != null &amp;&amp; !atlass.Contains(s.atlas))
                {
                    atlass.Add(s.atlas);
                }
            }
        }
        return atlass;
    }

    private void ReplacePrefabAtalas(GameObject prefab , UIAtlas atlas,UIAtlas targetAtlas)
    {
        if(prefab == null || atlas == null) return;
        UISprite[] sprites = prefab.GetComponentsInChildren&lt;UISprite&gt;(true);
        if(sprites != null &amp;&amp; sprites.Length &gt; 0)
        {
            int num = sprites.Length;
            for (int i = 0; i &lt; num; i++)
            {
                UISprite s = sprites[i];
                if(s != null &amp;&amp; s.atlas == atlas)
                {
                    s.atlas = targetAtlas;
                    EditorUtility.SetDirty(s);
                }
            }
        }
        AssetDatabase.SaveAssets();
    }

    public void AutoSelctPrefab(string prefabPath)
    {
        if(string.IsNullOrEmpty(prefabPath)) return;
        curReplacePrefabPath = prefabPath;
        curPrefabAtlas = GetPrefabAllAtlas(curReplacePrefabPath);
        curAtlas = null;
        targetAtlas = null;
    }
}
</code></pre><h2 id="代码Git地址"><a href="#代码Git地址" class="headerlink" title="代码Git地址"></a>代码Git地址</h2><p><a href="https://github.com/JingFengJi/ReplaceAtlas" target="_blank" rel="noopener"> https://github.com/JingFengJi/ReplaceAtlas</a><br>欢迎加星</p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/07/18/Unity编辑器拓展之十四：字体替换工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/18/Unity编辑器拓展之十四：字体替换工具/" class="post-title-link" itemprop="url">Unity编辑器拓展之十四：字体替换工具</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-18 21:56:19" itemprop="dateCreated datePublished" datetime="2018-07-18T21:56:19+08:00">2018-07-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:46" itemprop="dateModified" datetime="2019-03-11T22:04:46+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/07/18/Unity编辑器拓展之十四：字体替换工具/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之十四：字体替换工具">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="字体替换工具"><a href="#字体替换工具" class="headerlink" title="字体替换工具"></a>字体替换工具</h1><p><img src="https://img-blog.csdn.net/20180718215424988?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>选择NGUI还是UGUI，选择替换的字体以及字号比例，就可以替换工程目录下所有预制体的字体了</p>
<h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEditor;
using System.IO;
using UnityEngine.UI;
public class ReplaceFont : EditorWindow  
{
    private static ReplaceFont window = null;
    private static List&lt;string&gt; prefafbPathList = new List&lt;string&gt;();

    private static Font targetFont;
    private static Font curFont;
    private static float fontSizeRatio = 1f;
    private static bool isUGUI = true;

    [MenuItem(&quot;Tools/替换字体&quot;)]
    public static void CSVCode()
    {
        if (window == null)
        window = EditorWindow.GetWindow(typeof(ReplaceFont)) as ReplaceFont;
        GetFiles(new DirectoryInfo(Application.dataPath), &quot;*.prefab&quot;, ref prefafbPathList);
        window.titleContent = new GUIContent(&quot;ReplaceFont&quot;);
        window.Show();
    }
    public static void GetFiles(DirectoryInfo directory, string pattern, ref List&lt;string&gt; fileList)
    {
        if (directory != null &amp;&amp; directory.Exists &amp;&amp; !string.IsNullOrEmpty(pattern)) 
        {
            try 
            {
                foreach (FileInfo info in directory.GetFiles(pattern)) 
                {
                    string path = info.FullName.ToString();
                    fileList.Add(path.Substring (path.IndexOf (&quot;Assets&quot;)));
                }
            } 
            catch (System.Exception) 
            {
                throw;
            }
            foreach (DirectoryInfo info in directory.GetDirectories()) 
            {
                GetFiles(info, pattern, ref fileList);
            }
        }
    }
    void OnGUI()
    {
        EditorGUILayout.BeginHorizontal();
        isUGUI = EditorGUILayout.Toggle(&quot;UGUI&quot;,isUGUI);
        isUGUI = EditorGUILayout.Toggle(&quot;NGUI&quot;, !isUGUI);
        EditorGUILayout.EndHorizontal();
        curFont = (Font) EditorGUILayout.ObjectField(&quot;被替换字体&quot;, curFont, typeof(Font), true);
        targetFont = (Font) EditorGUILayout.ObjectField(&quot;目标字体&quot;, targetFont, typeof(Font), true);
        EditorGUILayout.BeginHorizontal();
        EditorGUILayout.LabelField(&quot;字号比例：&quot;);
        fontSizeRatio = EditorGUILayout.FloatField(fontSizeRatio);
        EditorGUILayout.EndHorizontal();
        if(GUILayout.Button(&quot;一键替换&quot;))
        {
            for (int i = 0; i&lt;prefafbPathList.Count; i++)
            {
                GameObject gameObj = AssetDatabase.LoadAssetAtPath&lt;GameObject&gt;(prefafbPathList[i]);
                Change(gameObj);
            }
        AssetDatabase.SaveAssets();
        }
    }

    public static void Change(GameObject prefab)
    {
        if(null != prefab)
        {
            Component[] labels = null;
            if(isUGUI)
            {
                labels = prefab.GetComponentsInChildren&lt;Text&gt;(true);
            }
            else
            {
                //labels = prefab.GetComponentsInChildren&lt;UILabel&gt;(true);
            }
            if(null != labels)
            foreach (Object item in labels)
            {
                if(isUGUI)
                {
                    Text text = (Text)item;
                    int newFontSize = (int)(text.fontSize * fontSizeRatio);
                    if (text.font.name == curFont.name)
                    {
                        text.font = targetFont;
                        text.fontSize = newFontSize;

                    }
                }
                else
                {
                    // UILabel label = (UILabel)item;
                    // int newFontSize = (int)(label.fontSize * fontSizeRatio);
                    // if (label.trueTypeFont.name == curFont.name)
                    // {
                    //      label.trueTypeFont = targetFont;
                    //      label.fontSize = newFontSize;
                    // }
                }
                EditorUtility.SetDirty(item);
            }
        }
    }
}
</code></pre><h1 id="代码下载"><a href="#代码下载" class="headerlink" title="代码下载"></a>代码下载</h1><p><a href="https://github.com/JingFengJi/ReplaceFont.git" target="_blank" rel="noopener"> https://github.com/JingFengJi/ReplaceFont.git</a></p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/07/17/Unity编辑器拓展之十三：CSV文件解析代码生成工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/17/Unity编辑器拓展之十三：CSV文件解析代码生成工具/" class="post-title-link" itemprop="url">Unity编辑器拓展之十三：CSV文件解析代码生成工具</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-17 22:30:06" itemprop="dateCreated datePublished" datetime="2018-07-17T22:30:06+08:00">2018-07-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:43" itemprop="dateModified" datetime="2019-03-11T22:04:43+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/07/17/Unity编辑器拓展之十三：CSV文件解析代码生成工具/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之十三：CSV文件解析代码生成工具">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="CSV文件解析代码生成工具"><a href="#CSV文件解析代码生成工具" class="headerlink" title="CSV文件解析代码生成工具"></a>CSV文件解析代码生成工具</h1><h3 id="工具示意图"><a href="#工具示意图" class="headerlink" title="工具示意图"></a>工具示意图</h3><p><img src="https://img-blog.csdn.net/20180717221145417?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>左侧是工程下所有的CSV文件列表，并提供搜索框，右侧是解析部分，上边提供了保存代码文件和拷贝代码的菜单，中间是CSV文件预解析出来的字段、数据类型（可选）等，下面是代码预览区域。</p>
<h3 id="获取所有CSV文件的路径"><a href="#获取所有CSV文件的路径" class="headerlink" title="获取所有CSV文件的路径"></a>获取所有CSV文件的路径</h3><p>使用递归获取所有CSV文件的路径，并绘制在左侧</p>
<pre><code>[MenuItem(&quot;Tools/CreateCSVParseCode&quot;)]
public static void CSVCode()
{
    csvFilesPathList.Clear ();
    assetPath = Application.dataPath;
    //获取所有CSV文件的路径
    GetFiles (new DirectoryInfo (assetPath), &quot;*.csv&quot;, ref csvFilesPathList);
    if (window == null)
        window = EditorWindow.GetWindow(typeof(CreateCSVParseCode)) as CreateCSVParseCode;
    window.titleContent = new GUIContent(&quot;CreateCSVParseCode&quot;);
    if(isLimitSize)
    {
        window.minSize = new Vector2(1420,674);
        window.maxSize = new Vector2(1420,674);
    }
    window.Show();
}

public static void GetFiles (DirectoryInfo directory, string pattern, ref List&lt;string&gt; fileList) 
{
    if (directory != null &amp;&amp; directory.Exists &amp;&amp; !string.IsNullOrEmpty (pattern)) {
        try {
            foreach (FileInfo info in directory.GetFiles (pattern)) {
                string path = info.FullName.ToString ();
                fileList.Add (path.Substring (path.IndexOf (&quot;Assets&quot;)));
            }
        } catch (System.Exception) 
        {
            throw;
        }
        foreach (DirectoryInfo info in directory.GetDirectories ()) 
        {
            GetFiles (info, pattern, ref fileList);
        }
    }
}
</code></pre><h3 id="预解析CSV文件"><a href="#预解析CSV文件" class="headerlink" title="预解析CSV文件"></a>预解析CSV文件</h3><p>定义一个类存储预解析数据</p>
<pre><code>public class CsvData
{
    public string header;
    public DataType dataType;
    public bool isParse = true;
}
public enum DataType
{
    Int = 0,
    String = 1,
    Double = 2,
    Bool = 3,
    //后续更新下面三种类型数据的解析
    //Vector3 = 4,
    //Vector2 = 5,
    //Color = 6,
}
</code></pre><p>详细代码参考后面代码工程git地址</p>
<h3 id="代码格式化"><a href="#代码格式化" class="headerlink" title="代码格式化"></a>代码格式化</h3><p>将解析代码格式化存储在一个类中，以string format的形式存在。</p>
<pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class CSVCodeConfig 
{
    public static string DataClassFormat = @&quot;public class {0}
{{
    {1}}}&quot;;

    //如果是带Vector3或者Vector3类型的数据需要使用带有UnityEngiine命名空间
    public static string DataClassNameSpaceFormat = @&quot;
using UnityEngine;

public class {0}
{{
    {1}
    }}&quot;;

    public static string FieldFormat = &quot;\tpubilc {0} {1} {{ set; get; }}&quot;;

    public static string ClassNameFormat = &quot;{0}Model&quot;;

    public static string ModelListPrivateStatementFormat = &quot;private List&lt;{0}&gt; {1}&quot;;

    public static string ModelListPublicPropertyFormat = @&quot;
public List&lt;{0}&gt; {1}
{{
        get
        {{
            if({2} == null)
            {{
                {3}();
            }}
        return {4};
    }}
}}&quot;;

    public static string parseMethodNameFormat = &quot;Init{0}&quot;;
    public static string methodFormat = &quot;{0}();&quot;;
    public static string ModelDataParseMethodFormat = @&quot;
private void {0}()
{{
        {1} = new List<{2}>;
        string path = DEFAULT_CSV_PATH + {3};
        CSVTable csvTable = CsvLoader.LoadCSV(path);
        foreach (CSVRecord record in csvTable.Records)
        {{
            {4} temp = new {5}();
            foreach (string header in csvTable.Headers)
            {{
                {6}
            }}
        {7}.Add(temp);
    }}
}}&quot;;

    public static string ModelDataHeaderEqualFormat_1 = @&quot;if (string.Equals(header, {0}))
            {{
                    {1}
                }}&quot;;

    public static string ModelDataHeaderEqualFormat_2 = @&quot;
            else if (string.Equals(header, {0}))
            {{
                    {1}
                }}&quot;;

    public static string ModelDataFieldValuationFormat_String = &quot;temp.{0} = record.GetField(header);&quot;;
    public static string ModelDataFieldValuationFormat_Int = &quot;temp.{0} = ConvertUtil.Str2Int(record.GetField(header));&quot;;
    public static string ModelDataFieldValuationFormat_Double = &quot;temp.{0} = ConvertUtil.Str2Double(record.GetField(header));&quot;;
    public static string ModelDataFieldValuationFormat_Bool = &quot;temp.{0} = ConvertUtil.Str2Int(record.GetField(header)) != 0;&quot;;

}
</{2}></code></pre><h3 id="完整工程"><a href="#完整工程" class="headerlink" title="完整工程"></a>完整工程</h3><p><a href="https://github.com/JingFengJi/CSVParseCodeCreate" target="_blank" rel="noopener"> https://github.com/JingFengJi/CSVParseCodeCreate</a></p>
<h3 id="第三方ReorderableList编辑器工具"><a href="#第三方ReorderableList编辑器工具" class="headerlink" title="第三方ReorderableList编辑器工具"></a>第三方ReorderableList编辑器工具</h3><p>Rotorz</p>
<p>下载地址： <a href="https://bitbucket.org/rotorz/reorderable-list-editor-field-for-unity" target="_blank" rel="noopener"> https://bitbucket.org/rotorz/reorderable-list-editor-field-for-unity</a></p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/07/06/游戏功能模块——新手引导/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/07/06/游戏功能模块——新手引导/" class="post-title-link" itemprop="url">游戏功能模块——新手引导</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-06 22:59:57" itemprop="dateCreated datePublished" datetime="2018-07-06T22:59:57+08:00">2018-07-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:02:44" itemprop="dateModified" datetime="2019-03-11T22:02:44+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2018/07/06/游戏功能模块——新手引导/" class="leancloud_visitors" data-flag-title="游戏功能模块——新手引导">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="新手引导"><a href="#新手引导" class="headerlink" title="新手引导"></a>新手引导</h1><h3 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h3><p><img src="https://img-blog.csdn.net/20180706225632527?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h3 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h3><p><img src="https://img-blog.csdn.net/20180706225847458?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><h5 id="遮罩Shader"><a href="#遮罩Shader" class="headerlink" title="遮罩Shader"></a>遮罩Shader</h5><p>1、圆形遮罩</p>
<pre><code>// Unity built-in shader source. Copyright (c) 2016 Unity Technologies. MIT license (see license.txt)

Shader &quot;UI/BeginnerGuidance/CircleGuidance&quot;
{
    Properties
    {
        [PerRendererData] _MainTex (&quot;Sprite Texture&quot;, 2D) = &quot;white&quot; {}
        _Color (&quot;Tint&quot;, Color) = (1,1,1,1)

        _StencilComp (&quot;Stencil Comparison&quot;, Float) = 8
        _Stencil (&quot;Stencil ID&quot;, Float) = 0
        _StencilOp (&quot;Stencil Operation&quot;, Float) = 0
        _StencilWriteMask (&quot;Stencil Write Mask&quot;, Float) = 255
        _StencilReadMask (&quot;Stencil Read Mask&quot;, Float) = 255

        _ColorMask (&quot;Color Mask&quot;, Float) = 15

        [Toggle(UNITY_UI_ALPHACLIP)] _UseUIAlphaClip (&quot;Use Alpha Clip&quot;, Float) = 0

        _Center(&quot;Center&quot;,vector) = (0,0,0,0)
        _Slider(&quot;Slider&quot;,Range(0,1500)) = 1500
    }

    SubShader
    {
        Tags
        {
            &quot;Queue&quot;=&quot;Transparent&quot;
            &quot;IgnoreProjector&quot;=&quot;True&quot;
            &quot;RenderType&quot;=&quot;Transparent&quot;
            &quot;PreviewType&quot;=&quot;Plane&quot;
            &quot;CanUseSpriteAtlas&quot;=&quot;True&quot;
        }

        Stencil
        {
            Ref [_Stencil]
            Comp [_StencilComp]
            Pass [_StencilOp]
            ReadMask [_StencilReadMask]
            WriteMask [_StencilWriteMask]
        }

        Cull Off
        Lighting Off
        ZWrite Off
        ZTest [unity_GUIZTestMode]
        Blend SrcAlpha OneMinusSrcAlpha
        ColorMask [_ColorMask]

        Pass
        {
            Name &quot;Default&quot;
        CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            #pragma target 2.0

            #include &quot;UnityCG.cginc&quot;
            #include &quot;UnityUI.cginc&quot;

            #pragma multi_compile __ UNITY_UI_CLIP_RECT
            #pragma multi_compile __ UNITY_UI_ALPHACLIP

            struct appdata_t
            {
                float4 vertex   : POSITION;
                float4 color    : COLOR;
                float2 texcoord : TEXCOORD0;
                UNITY_VERTEX_INPUT_INSTANCE_ID
            };

            struct v2f
            {
                float4 vertex   : SV_POSITION;
                fixed4 color    : COLOR;
                float2 texcoord  : TEXCOORD0;
                float4 worldPosition : TEXCOORD1;
                UNITY_VERTEX_OUTPUT_STEREO
            };

            fixed4 _Color;
            fixed4 _TextureSampleAdd;
            float4 _ClipRect;
            float2 _Center;
            float _Slider;

            v2f vert(appdata_t v)
            {
                v2f OUT;
                UNITY_SETUP_INSTANCE_ID(v);
                UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(OUT);
                OUT.worldPosition = v.vertex;
                OUT.vertex = UnityObjectToClipPos(OUT.worldPosition);

                OUT.texcoord = v.texcoord;

                OUT.color = v.color * _Color;
                return OUT;
            }

            sampler2D _MainTex;

            fixed4 frag(v2f IN) : SV_Target
            {
                half4 color = (tex2D(_MainTex, IN.texcoord) + _TextureSampleAdd) * IN.color;

                #ifdef UNITY_UI_CLIP_RECT
                color.a *= UnityGet2DClipping(IN.worldPosition.xy, _ClipRect);
                #endif

                #ifdef UNITY_UI_ALPHACLIP
                clip (color.a - 0.001);
                #endif

                color.a *= (distance(IN.worldPosition.xy, _Center.xy) &gt; _Slider);
                color.rgb *= color.a;

                return color;
            }
        ENDCG
        }
    }
}
</code></pre><p>2、矩形遮罩</p>
<pre><code>// Unity built-in shader source. Copyright (c) 2016 Unity Technologies. MIT license (see license.txt)

Shader &quot;UI/BeginnerGuidance/Rect&quot;
{
    Properties
    {
        [PerRendererData] _MainTex (&quot;Sprite Texture&quot;, 2D) = &quot;white&quot; {}
        _Color (&quot;Tint&quot;, Color) = (1,1,1,1)

        _StencilComp (&quot;Stencil Comparison&quot;, Float) = 8
        _Stencil (&quot;Stencil ID&quot;, Float) = 0
        _StencilOp (&quot;Stencil Operation&quot;, Float) = 0
        _StencilWriteMask (&quot;Stencil Write Mask&quot;, Float) = 255
        _StencilReadMask (&quot;Stencil Read Mask&quot;, Float) = 255

        _ColorMask (&quot;Color Mask&quot;, Float) = 15

        [Toggle(UNITY_UI_ALPHACLIP)] _UseUIAlphaClip (&quot;Use Alpha Clip&quot;, Float) = 0

        _Center(&quot;Center&quot;,vector) = (0,0,0,0)
        _SliderX(&quot;SliderX&quot;,Range(0,1500)) = 1500
        _SliderY(&quot;SliderY&quot;,Range(0,1500)) = 1500
    }

    SubShader
    {
        Tags
        {
            &quot;Queue&quot;=&quot;Transparent&quot;
            &quot;IgnoreProjector&quot;=&quot;True&quot;
            &quot;RenderType&quot;=&quot;Transparent&quot;
            &quot;PreviewType&quot;=&quot;Plane&quot;
            &quot;CanUseSpriteAtlas&quot;=&quot;True&quot;
        }

        Stencil
        {
            Ref [_Stencil]
            Comp [_StencilComp]
            Pass [_StencilOp]
            ReadMask [_StencilReadMask]
            WriteMask [_StencilWriteMask]
        }

        Cull Off
        Lighting Off
        ZWrite Off
        ZTest [unity_GUIZTestMode]
        Blend SrcAlpha OneMinusSrcAlpha
        ColorMask [_ColorMask]

        Pass
        {
            Name &quot;Default&quot;
        CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            #pragma target 2.0

            #include &quot;UnityCG.cginc&quot;
            #include &quot;UnityUI.cginc&quot;

            #pragma multi_compile __ UNITY_UI_CLIP_RECT
            #pragma multi_compile __ UNITY_UI_ALPHACLIP

            struct appdata_t
            {
                float4 vertex   : POSITION;
                float4 color    : COLOR;
                float2 texcoord : TEXCOORD0;
                UNITY_VERTEX_INPUT_INSTANCE_ID
            };

            struct v2f
            {
                float4 vertex   : SV_POSITION;
                fixed4 color    : COLOR;
                float2 texcoord  : TEXCOORD0;
                float4 worldPosition : TEXCOORD1;
                UNITY_VERTEX_OUTPUT_STEREO
            };

            fixed4 _Color;
            fixed4 _TextureSampleAdd;
            float4 _ClipRect;

            float2 _Center;
            float _SliderX;
            float _SliderY;

            v2f vert(appdata_t v)
            {
                v2f OUT;
                UNITY_SETUP_INSTANCE_ID(v);
                UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(OUT);
                OUT.worldPosition = v.vertex;
                OUT.vertex = UnityObjectToClipPos(OUT.worldPosition);

                OUT.texcoord = v.texcoord;

                OUT.color = v.color * _Color;
                return OUT;
            }

            sampler2D _MainTex;

            fixed4 frag(v2f IN) : SV_Target
            {
                half4 color = (tex2D(_MainTex, IN.texcoord) + _TextureSampleAdd) * IN.color;

                #ifdef UNITY_UI_CLIP_RECT
                color.a *= UnityGet2DClipping(IN.worldPosition.xy, _ClipRect);
                #endif

                #ifdef UNITY_UI_ALPHACLIP
                clip (color.a - 0.001);
                #endif

                float2 dis = IN.worldPosition.xy - _Center.xy;
                color.a *= (abs(dis.x) &gt; _SliderX) || (abs(dis.y) &gt; _SliderY);
                color.rgb *= color.a;

                return color;
            }
        ENDCG
        }
    }
}
</code></pre><p>持续更新中……</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/06/24/Unity编辑器拓展之十二：预制体层级全预览/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/24/Unity编辑器拓展之十二：预制体层级全预览/" class="post-title-link" itemprop="url">Unity编辑器拓展之十二：预制体层级全预览</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-24 22:25:52" itemprop="dateCreated datePublished" datetime="2018-06-24T22:25:52+08:00">2018-06-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:31" itemprop="dateModified" datetime="2019-03-11T22:04:31+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/06/24/Unity编辑器拓展之十二：预制体层级全预览/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之十二：预制体层级全预览">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="预制体层级全预览"><a href="#预制体层级全预览" class="headerlink" title="预制体层级全预览"></a>预制体层级全预览</h1><h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>Asset面板下预制体并不会显示全，制作一个工具显示预制体的全部层级，这算是TreeView的一个应用</p>
<p><img src="https://img-blog.csdn.net/2018062422144114?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p>代码中用了 <a href="https://blog.csdn.net/qq_26999509/article/details/80794973" target="_blank" rel="noopener"> Unity编辑器拓展之十一：通过Image Name反查Prefab</a><br>中的一个类PrefabTreeView</p>
<pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEditor.IMGUI.Controls;
using UnityEngine;

public class GameObjectTreeViewItem {
    public TreeViewItem viewItem;
    public Transform treeViewTrans;
    public Transform parent;
    public List&lt;Transform&gt; childs = new List&lt;Transform&gt; ();

    public bool IsChild (Transform tran) {
        if (null == tran) return false;
        if (tran.parent == treeViewTrans) return true;
        return false;
    }

    public void AddChildTransform (Transform childTransform) {
        if (null != childTransform)
            childs.Add (childTransform);
    }

    public bool HasChildTransform (Transform tran) {
        if (null == tran) return false;
        return childs.Contains (tran);
    }
}

public class PrefabTreeView : TreeView {
    private Transform[] childs;
    private GameObjectTreeViewItem[] items;
    public PrefabTreeView (TreeViewState state, GameObject go) : base (state) {
        treeGameObject = go;
        childs = treeGameObject.GetComponentsInChildren&lt;Transform&gt; (true);
        items = new GameObjectTreeViewItem[childs.Length];
        #region Init Items Parent
        for (int i = 0; i &lt; childs.Length; i++) {
            items[i] = new GameObjectTreeViewItem ();
            items[i].treeViewTrans = childs[i];
            if (childs[i].parent != null)
                items[i].parent = childs[i].parent;
        }
        #endregion

        #region Init Child Transform
        for (int i = 0; i &lt; childs.Length; i++) {
            for (int j = 0; j &lt; items.Length; j++) {
                if (items[j].IsChild (childs[i])) {
                    items[j].AddChildTransform (childs[i]);
                    break;
                }
            }
        }
        #endregion
        Reload ();
    }

    private GameObject treeGameObject;

    private GameObjectTreeViewItem GetGameObjectTreeViewItem (GameObjectTreeViewItem[] items, Transform trans) {
        if (null == items || items.Length == 0 || trans == null)
            return null;
        for (int i = 0; i &lt; items.Length; i++) {
            if (items[i] != null &amp;&amp; items[i].treeViewTrans == trans)
                return items[i];
        }
        return null;
    }

    private GameObjectTreeViewItem GetGameObjectTreeViewItem (GameObjectTreeViewItem[] items, TreeViewItem viewItem) {
        if (null == items || items.Length == 0 || viewItem == null)
            return null;
        for (int i = 0; i &lt; items.Length; i++) {
            if (null != items &amp;&amp; items[i].viewItem == viewItem)
                return items[i];
        }
        return null;
    }

    protected override TreeViewItem BuildRoot () {
        TreeViewItem root = new TreeViewItem { id = 0, depth = -1, displayName = &quot;root&quot; };
        TreeViewItem[] childItems = new TreeViewItem[childs.Length];
        for (int i = 0; i &lt; childs.Length; i++) {
            childItems[i] = new TreeViewItem { id = i + 1, displayName = childs[i].name };
            GameObjectTreeViewItem item = GetGameObjectTreeViewItem (items, childs[i]);
            if (null != item) {
                item.viewItem = childItems[i];
            }
        }
        root.AddChild (childItems[0]);
        for (int i = 0; i &lt; childItems.Length; i++) {
            GameObjectTreeViewItem temp = GetGameObjectTreeViewItem (items, childItems[i]);
            if (temp != null &amp;&amp; temp.childs != null) {
                for (int j = 0; j &lt; temp.childs.Count; j++) {
                    GameObjectTreeViewItem childItem = GetGameObjectTreeViewItem (items, temp.childs[j]);
                    if (childItem != null &amp;&amp; childItem.viewItem != null) {
                        childItems[i].AddChild (childItem.viewItem);
                    }
                }
            }
        }

        SetupDepthsFromParentsAndChildren (root);
        return root;
    }
}


using System.Collections;
using System.Collections.Generic;
using UnityEditor;
using UnityEditor.IMGUI.Controls;
using UnityEngine;

public class PrefabViewWindow : EditorWindow {

    private GameObject selectPrefab = null;
    [SerializeField]
    TreeViewState treeViewState;
    PrefabTreeView prefabTreeView;

    void OnEnable () {
        if (null == treeViewState)
            treeViewState = new TreeViewState ();
    }

    [MenuItem (&quot;PrefabView/PrefabViewWindow&quot;)]
    private static void ShowWindow () {
        GetWindow&lt;PrefabViewWindow&gt; ().Show ();
    }

    private void OnGUI () {
        if (null != selectPrefab) {
            Rect rect = GUILayoutUtility.GetRect (0, 100000, 0, 100000);
            prefabTreeView = new PrefabTreeView (treeViewState, selectPrefab);

            prefabTreeView.OnGUI (rect);
            prefabTreeView.ExpandAll ();
        } else {

        }
    }

    void OnSelectionChange () {
        selectPrefab = Selection.activeObject as GameObject;
        Repaint();
    }
}
</code></pre><h3 id="Code下载"><a href="#Code下载" class="headerlink" title="Code下载"></a>Code下载</h3><p><a href="https://github.com/JingFengJi/PrefabViewWindow" target="_blank" rel="noopener"> https://github.com/JingFengJi/PrefabViewWindow</a></p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/06/24/Unity编辑器拓展之十一：通过Image Name反查Prefab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/24/Unity编辑器拓展之十一：通过Image Name反查Prefab/" class="post-title-link" itemprop="url">Unity编辑器拓展之十一：通过Image Name反查Prefab</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-24 21:43:35" itemprop="dateCreated datePublished" datetime="2018-06-24T21:43:35+08:00">2018-06-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:51" itemprop="dateModified" datetime="2019-03-11T22:04:51+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/06/24/Unity编辑器拓展之十一：通过Image Name反查Prefab/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之十一：通过Image Name反查Prefab">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="通过Image-Name快速反查Prefab"><a href="#通过Image-Name快速反查Prefab" class="headerlink" title="通过Image Name快速反查Prefab"></a>通过Image Name快速反查Prefab</h1><h3 id="开发思路"><a href="#开发思路" class="headerlink" title="开发思路"></a>开发思路</h3><p>1、获取到工程中所有Prefab<br>2、获取Prefab的所有Image和RawImage<br>3、检测Prefab下是否存在指定名称的Image</p>
<h3 id="编辑器示意图"><a href="#编辑器示意图" class="headerlink" title="编辑器示意图"></a>编辑器示意图</h3><p><img src="https://img-blog.csdn.net/2018062421264348?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>编辑器包括三个部分：<br>1、搜索框<br>2、预制体列表<br>3、预制体层级</p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><pre><code>using System.Collections;
using System.Collections.Generic;
using System.IO;
using UnityEditor;
using UnityEditor.IMGUI.Controls;
using UnityEngine;
using UnityEngine.UI;

public class FindPrefabByImage : EditorWindow {
        private static string assetPath;
        private static List&lt;string&gt; prefabPaths = new List&lt;string&gt; ();
        private bool initialized = false;
        private SearchField searchField;
        private string searchStr;
        Rect toolbarRect {
            get { return new Rect (20f, 10f, position.width - 40f, 20f); }
        }

        Rect searchResultViewRect {
            get { return new Rect (20f, 40f, (position.width - 40) / 2, position.height - 40f); }
        }

        Rect selectPrefabHierarchyViewRect {
            get { return new Rect (position.width / 2, 40, (position.width - 40) / 2, position.height - 40f); }
        }

        Vector2 searchResultScrollViewPos = Vector2.zero;

        [SerializeField]
        TreeViewState treeViewState;
        PrefabTreeView prefabTreeView;

        private GameObject curSelectPrefab;

        void OnEnable () {
            if (null == treeViewState)
                treeViewState = new TreeViewState ();
        }

        [MenuItem (&quot;CommonTools/图片反查预制体引用工具&quot;)]
        public static FindPrefabByImage GetWindow () {
            prefabPaths.Clear ();
            assetPath = Application.dataPath;
            GetFiles (new DirectoryInfo (assetPath), &quot;*.prefab&quot;, ref prefabPaths);
            var window = GetWindow&lt;FindPrefabByImage&gt; ();
            window.titleContent = new GUIContent (&quot;FindPrefab&quot;);
            window.Focus ();
            window.Repaint ();
            return window;
        }

        public static void GetFiles (DirectoryInfo directory, string pattern, ref List&lt;string&gt; fileList) {
            if (directory != null &amp;&amp; directory.Exists &amp;&amp; !string.IsNullOrEmpty (pattern)) {
                try {
                    foreach (FileInfo info in directory.GetFiles (pattern)) {
                        string path = info.FullName.ToString ();
                        fileList.Add (path.Substring (path.IndexOf (&quot;Assets&quot;)));
                    }
                } catch (System.Exception) {

                    throw;
                }
                foreach (DirectoryInfo info in directory.GetDirectories ()) {
                    GetFiles (info, pattern, ref fileList);
                }
            }
        }

        /// &lt;summary&gt;
        /// 检测预制体是否包含Image组件
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;prefab&quot;&gt;检测的预制体&lt;/param&gt;
        /// &lt;param name=&quot;imageName&quot;&gt;Image名称，可为空&lt;/param&gt;
        /// &lt;returns&gt;如果Image名称为空且预制体包含Image组件，或者Image不为空预制体包含该指定Image，则返回true，否则返回false&lt;/returns&gt;
        public static bool CheckPrefabHasImage (GameObject prefab, string imageName = null) {
            if (!string.IsNullOrEmpty (imageName))
                imageName = imageName.ToLower ();
            if (null == prefab) return false;
            Image[] images = prefab.GetComponentsInChildren&lt;Image&gt; (true);
            if (null != images &amp;&amp; images.Length &gt; 0) {
                if (string.IsNullOrEmpty (imageName)) {
                    return true;
                } else {
                    for (int i = 0; i &lt; images.Length; i++) {
                        if (null != images[i] &amp;&amp; images[i].sprite != null &amp;&amp; images[i].sprite.name.ToLower() == imageName) {
                            return true;
                        }
                    }
                }
            }
            RawImage[] rawImages = prefab.GetComponentsInChildren&lt;RawImage&gt; (true);
            if (null != rawImages &amp;&amp; rawImages.Length &gt; 0) {
                if (string.IsNullOrEmpty (imageName)) {
                    return true;
                } else {
                    for (int i = 0; i &lt; rawImages.Length; i++) {
                        if (null != rawImages[i] &amp;&amp; null != rawImages[i].texture &amp;&amp; rawImages[i].texture.name.ToLower() == imageName) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        private void InitIfNeeded () {
            if (!initialized) {
                if (null == searchField)
                    searchField = new SearchField ();
                initialized = true;
            }
        }

        void OnGUI () {
            InitIfNeeded ();
            DoSearchField ();

            DoSearchResultView ();
            DoSelectPrefabHierarchyVieww ();
        }

        private void DoSearchField () {
            searchStr = searchField.OnGUI (toolbarRect, searchStr);
        }

        private void DoSearchResultView () {
            GUILayout.BeginArea (searchResultViewRect);
            searchResultScrollViewPos = GUILayout.BeginScrollView (searchResultScrollViewPos);

            for (int i = 0; i &lt; prefabPaths.Count; i++) {
                 GameObject gameObj = AssetDatabase.LoadAssetAtPath&lt;GameObject&gt; (@prefabPaths[i]);
                if (gameObj != null)
                {
                    bool result = CheckPrefabHasImage (gameObj,searchStr);
                    if (result)
                    {
                        if (GUILayout.Button (prefabPaths[i]))
                        {
                            curSelectPrefab = gameObj;
                        }
                    }
                }
            }

            GUILayout.EndScrollView ();
            GUILayout.EndArea ();
        }

    private void DoSelectPrefabHierarchyVieww () {
        GUILayout.BeginArea (selectPrefabHierarchyViewRect);
        if (null != curSelectPrefab) {
            Rect rect = GUILayoutUtility.GetRect (0, 100000, 0, 100000);
            prefabTreeView = new PrefabTreeView (treeViewState, curSelectPrefab);

            prefabTreeView.OnGUI (rect);
            prefabTreeView.ExpandAll ();
        } else {

        }
        GUILayout.EndArea ();
    }
}


using System.Collections;
using System.Collections.Generic;
using UnityEditor.IMGUI.Controls;
using UnityEngine;

public class GameObjectTreeViewItem {
    public TreeViewItem viewItem;
    public Transform treeViewTrans;
    public Transform parent;
    public List&lt;Transform&gt; childs = new List&lt;Transform&gt; ();

    public bool IsChild (Transform tran) {
        if (null == tran) return false;
        if (tran.parent == treeViewTrans) return true;
        return false;
    }

    public void AddChildTransform (Transform childTransform) {
        if (null != childTransform)
            childs.Add (childTransform);
    }

    public bool HasChildTransform (Transform tran) {
        if (null == tran) return false;
        return childs.Contains (tran);
    }
}

public class PrefabTreeView : TreeView {
    private Transform[] childs;
    private GameObjectTreeViewItem[] items;
    public PrefabTreeView (TreeViewState state, GameObject go) : base (state) {
        treeGameObject = go;
        childs = treeGameObject.GetComponentsInChildren&lt;Transform&gt; (true);
        items = new GameObjectTreeViewItem[childs.Length];
        #region Init Items Parent
        for (int i = 0; i &lt; childs.Length; i++) {
            items[i] = new GameObjectTreeViewItem ();
            items[i].treeViewTrans = childs[i];
            if (childs[i].parent != null)
                items[i].parent = childs[i].parent;
        }
        #endregion

        #region Init Child Transform
        for (int i = 0; i &lt; childs.Length; i++) {
            for (int j = 0; j &lt; items.Length; j++) {
                if (items[j].IsChild (childs[i])) {
                    items[j].AddChildTransform (childs[i]);
                    break;
                }
            }
        }
        #endregion
        Reload ();
    }

    private GameObject treeGameObject;

    private GameObjectTreeViewItem GetGameObjectTreeViewItem (GameObjectTreeViewItem[] items, Transform trans) {
        if (null == items || items.Length == 0 || trans == null)
            return null;
        for (int i = 0; i &lt; items.Length; i++) {
            if (items[i] != null &amp;&amp; items[i].treeViewTrans == trans)
                return items[i];
        }
        return null;
    }

    private GameObjectTreeViewItem GetGameObjectTreeViewItem (GameObjectTreeViewItem[] items, TreeViewItem viewItem) {
        if (null == items || items.Length == 0 || viewItem == null)
            return null;
        for (int i = 0; i &lt; items.Length; i++) {
            if (null != items &amp;&amp; items[i].viewItem == viewItem)
                return items[i];
        }
        return null;
    }

    protected override TreeViewItem BuildRoot () {
        TreeViewItem root = new TreeViewItem { id = 0, depth = -1, displayName = &quot;root&quot; };
        TreeViewItem[] childItems = new TreeViewItem[childs.Length];
        for (int i = 0; i &lt; childs.Length; i++) {
            childItems[i] = new TreeViewItem { id = i + 1, displayName = childs[i].name };
            GameObjectTreeViewItem item = GetGameObjectTreeViewItem (items, childs[i]);
            if (null != item) {
                item.viewItem = childItems[i];
            }
        }
        root.AddChild (childItems[0]);
        for (int i = 0; i &lt; childItems.Length; i++) {
            GameObjectTreeViewItem temp = GetGameObjectTreeViewItem (items, childItems[i]);
            if (temp != null &amp;&amp; temp.childs != null) {
                for (int j = 0; j &lt; temp.childs.Count; j++) {
                    GameObjectTreeViewItem childItem = GetGameObjectTreeViewItem (items, temp.childs[j]);
                    if (childItem != null &amp;&amp; childItem.viewItem != null) {
                        childItems[i].AddChild (childItem.viewItem);
                    }
                }
            }
        }

        SetupDepthsFromParentsAndChildren (root);
        return root;
    }
}
</code></pre><p>代码中用到了TreeView的知识，请自行补充，后续会更新关系TreeView的知识点</p>
<h3 id="Code下载"><a href="#Code下载" class="headerlink" title="Code下载"></a>Code下载</h3><p><a href="https://github.com/JingFengJi/FindPrefabByImage" target="_blank" rel="noopener"> https://github.com/JingFengJi/FindPrefabByImage</a></p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/06/22/Unity编辑器拓展之十：UI对齐工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/22/Unity编辑器拓展之十：UI对齐工具/" class="post-title-link" itemprop="url">Unity编辑器拓展之十：UI对齐工具</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-22 22:45:19" itemprop="dateCreated datePublished" datetime="2018-06-22T22:45:19+08:00">2018-06-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:25" itemprop="dateModified" datetime="2019-03-11T22:04:25+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/06/22/Unity编辑器拓展之十：UI对齐工具/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之十：UI对齐工具">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="示例图"><a href="#示例图" class="headerlink" title="示例图"></a>示例图</h1><p><img src="https://img-blog.csdn.net/20180622214023588?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><img src="https://img-blog.csdn.net/20180622214216448?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h1 id="开发思路"><a href="#开发思路" class="headerlink" title="开发思路"></a>开发思路</h1><p>1、获取选中的UI<br>2、根据对齐规则修改所选中UI的坐标</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="UGUIAlign-cs"><a href="#UGUIAlign-cs" class="headerlink" title="UGUIAlign.cs"></a>UGUIAlign.cs</h2><pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEditor;
using UnityEngine;

public enum AlignType
{
    Top = 1,
    Left = 2,
    Right = 3,
    Bottom = 4,
    HorizontalCenter = 5,       //水平居中
    VerticalCenter = 6,         //垂直居中
    Horizontal = 7,             //横向分布
    Vertical = 8,               //纵向分布
}

public class UGUIAlign : Editor
{
    [MenuItem(&quot;GameObject/UI/Align/Left 【左对齐】&quot;)]
    static void AlignLeft()
    {
        Align(AlignType.Left);
    }
    [MenuItem(&quot;GameObject/UI/Align/HorizontalCenter 【水平居中】&quot;)]
    static void AlignHorizontalCenter()
    {
        Align(AlignType.HorizontalCenter);
    }
    [MenuItem(&quot;GameObject/UI/Align/Right 【右对齐】&quot;)]
    static void AlignRight()
    {
        Align(AlignType.Right);
    }
    [MenuItem(&quot;GameObject/UI/Align/Top 【顶端对齐】&quot;)]
    static void AlignTop()
    {
        Align(AlignType.Top);
    }
    [MenuItem(&quot;GameObject/UI/Align/VerticalCenter 【垂直居中】&quot;)]
    static void AlignVerticalCenter()
    {
        Align(AlignType.VerticalCenter);
    }
    [MenuItem(&quot;GameObject/UI/Align/Bottom 【底端对齐】&quot;)]
    static void AlignBottom()
    {
        Align(AlignType.Bottom);
    }
    [MenuItem(&quot;GameObject/UI/Align/Horizontal 【横向分布】&quot;)]
    static void AlignHorizontal()
    {
        Align(AlignType.Horizontal);
    }
    [MenuItem(&quot;GameObject/UI/Align/Vertical 【纵向分布】&quot;)]
    static void AlignVertical()
    {
        Align(AlignType.Vertical);
    }

    public static void Align(AlignType type)
    {
        List&lt;RectTransform&gt; rects = new List&lt;RectTransform&gt;();
        GameObject[] objects = Selection.gameObjects;
        if (objects != null &amp;&amp; objects.Length &gt; 0)
        {
            for (int i = 0; i &lt; objects.Length; i++)
            {
                RectTransform rect = objects[i].GetComponent&lt;RectTransform&gt;();
                if (rect != null)
                    rects.Add(rect);
            }
        }

        if (rects.Count &gt; 1)
        {
            Align(type, rects);
        }
    }

    public static void Align(AlignType type, List&lt;RectTransform&gt; rects)
    {
        RectTransform tenplate = rects[0];
        float w = tenplate.sizeDelta.x * tenplate.lossyScale.x;
        float h = tenplate.sizeDelta.y * tenplate.localScale.y;

        float x = tenplate.position.x - tenplate.pivot.x * w;
        float y = tenplate.position.y - tenplate.pivot.y * h;

        switch (type)
        {
            case AlignType.Top:
                for (int i = 1; i &lt; rects.Count; i++)
                {
                    RectTransform trans = rects[i];
                    float th = trans.sizeDelta.y * trans.localScale.y;
                    Vector3 pos = trans.position;
                    pos.y = y + h - th + trans.pivot.y * th;
                    trans.position = pos;
                }
                break;
            case AlignType.Left:
                for (int i = 1; i &lt; rects.Count; i++)
                {
                    RectTransform trans = rects[i];
                    float tw = trans.sizeDelta.x * trans.lossyScale.x;
                    Vector3 pos = trans.position;
                    pos.x = x + tw * trans.pivot.x;
                    trans.position = pos;
                }
                break;
            case AlignType.Right:
                for (int i = 1; i &lt; rects.Count; i++)
                {
                    RectTransform trans = rects[i];
                    float tw = trans.sizeDelta.x * trans.lossyScale.x;
                    Vector3 pos = trans.position;
                    pos.x = x + w - tw + tw * trans.pivot.x;
                    trans.position = pos;
                }
                break;
            case AlignType.Bottom:
                for (int i = 1; i &lt; rects.Count; i++)
                {
                    RectTransform trans = rects[i];
                    float th = trans.sizeDelta.y * trans.localScale.y;
                    Vector3 pos = trans.position;
                    pos.y = y + th * trans.pivot.y;
                    trans.position = pos;
                }
                break;
            case AlignType.HorizontalCenter:
                for (int i = 1; i &lt; rects.Count; i++)
                {
                    RectTransform trans = rects[i];
                    float tw = trans.sizeDelta.x * trans.lossyScale.x;
                    Vector3 pos = trans.position;
                    pos.x = x + 0.5f * w - 0.5f * tw + tw * trans.pivot.x;
                    trans.position = pos;
                }
                break;
            case AlignType.VerticalCenter:
                for (int i = 1; i &lt; rects.Count; i++)
                {
                    RectTransform trans = rects[i];
                    float th = trans.sizeDelta.y * trans.localScale.y;
                    Vector3 pos = trans.position;
                    pos.y = y + 0.5f * h - 0.5f * th + th * trans.pivot.y;
                    trans.position = pos;
                }
                break;
            case AlignType.Horizontal:
                float minX = GetMinX(rects);
                float maxX = GetMaxX(rects);
                rects.Sort(SortListRectTransformByX);
                float distance = (maxX - minX)/(rects.Count - 1);
                for (int i = 1; i &lt; rects.Count - 1; i++)
                {
                    RectTransform trans = rects[i];
                    Vector3 pos = trans.position;
                    pos.x = minX + i * distance;
                    trans.position = pos;
                }
                break;
            case AlignType.Vertical:
                float minY = GetMinY(rects);
                float maxY = GetMaxY(rects);
                rects.Sort(SortListRectTransformByY);
                float distanceY = (maxY - minY)/(rects.Count - 1);
                for (int i = 1; i &lt; rects.Count - 1; i++)
                {
                    RectTransform trans = rects[i];
                    Vector3 pos = trans.position;
                    pos.y = minY + i*distanceY;
                    trans.position = pos;
                }
                break;
        }
    }

    private static int SortListRectTransformByX(RectTransform r1, RectTransform r2)
    {
        float w = r1.sizeDelta.x * r1.lossyScale.x;
        float x1 = r1.position.x - r1.pivot.x * w;
        w = r2.sizeDelta.x * r2.lossyScale.x;
        float x2 = r2.position.x - r2.pivot.x * w;
        if (x1 &gt;= x2)
            return 1;
        else
            return -1;
    }

    private static int SortListRectTransformByY(RectTransform r1, RectTransform r2)
    {
        float w = r1.sizeDelta.y * r1.lossyScale.y;
        float y1 = r1.position.y - r1.pivot.y * w;
        w = r2.sizeDelta.y * r2.lossyScale.y;
        float y2 = r2.position.y - r2.pivot.y * w;
        if (y1 &gt;= y2)
            return 1;
        else
            return -1;
    }

    private static float GetMinX(List&lt;RectTransform&gt; rects)
    {
        if (null == rects || rects.Count == 0)
            return 0;
        RectTransform tenplate = rects[0];
        float minx = tenplate.position.x;
        float tempX = 0;
        for (int i = 1; i &lt; rects.Count; i++)
        {
            tempX = rects[i].position.x;
            if (tempX &lt; minx)
                minx = tempX;
        }
        return minx;
    }

    private static float GetMaxX(List&lt;RectTransform&gt; rects)
    {
        if (null == rects || rects.Count == 0)
            return 0;
        RectTransform tenplate = rects[0];
        float maxX = tenplate.position.x;
        float tempX = 0;
        for (int i = 1; i &lt; rects.Count; i++)
        {
            tempX = rects[i].position.x;
            if (tempX &gt; maxX)
                maxX = tempX;
        }
        return maxX;
    }

    private static float GetMinY(List&lt;RectTransform&gt; rects)
    {
        if (null == rects || rects.Count == 0)
            return 0;
        RectTransform tenplate = rects[0];
        float minY = tenplate.position.y;
        float tempX = 0;
        for (int i = 1; i &lt; rects.Count; i++)
        {
            tempX = rects[i].position.y;
            if (tempX &lt; minY)
                minY = tempX;
        }
        return minY;
    }

    private static float GetMaxY(List&lt;RectTransform&gt; rects)
    {
        if (null == rects || rects.Count == 0)
            return 0;
        RectTransform tenplate = rects[0];
        float maxY = tenplate.position.y;
        float tempX = 0;
        for (int i = 1; i &lt; rects.Count; i++)
        {
            tempX = rects[i].position.y;
            if (tempX &gt; maxY)
                maxY = tempX;
        }
        return maxY;
    }
}
</code></pre><h2 id="UGUIAlignWindow-cs"><a href="#UGUIAlignWindow-cs" class="headerlink" title="UGUIAlignWindow.cs"></a>UGUIAlignWindow.cs</h2><p>为了操作更加便捷，提供一个EditorWindow类</p>
<pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEditor;
using UnityEngine;

public class UGUIAlignWindow : EditorWindow
{
    private Dictionary&lt;AlignType,Texture&gt; alignTexture = new Dictionary&lt;AlignType, Texture&gt;(); 
    void OnEnable()
    {
        Texture leftTexture = Resources.Load&lt;Texture&gt;(&quot;Textures/Left&quot;);
        Texture horizontalCenterTexture = Resources.Load&lt;Texture&gt;(&quot;Textures/HorizontalCenter&quot;);
        Texture rightTexture = Resources.Load&lt;Texture&gt;(&quot;Textures/Right&quot;);
        Texture topTexture = Resources.Load&lt;Texture&gt;(&quot;Textures/Top&quot;);
        Texture verticalCenterTexture = Resources.Load&lt;Texture&gt;(&quot;Textures/VerticalCenter&quot;);
        Texture bottomTexture = Resources.Load&lt;Texture&gt;(&quot;Textures/Bottom&quot;);
        Texture horizontalTexture = Resources.Load&lt;Texture&gt;(&quot;Textures/Horizontal&quot;);
        Texture verticalTexture = Resources.Load&lt;Texture&gt;(&quot;Textures/Vertical&quot;);
        alignTexture.Add(AlignType.Left, leftTexture);
        alignTexture.Add(AlignType.HorizontalCenter, horizontalCenterTexture);
        alignTexture.Add(AlignType.Right, rightTexture);
        alignTexture.Add(AlignType.Top, topTexture);
        alignTexture.Add(AlignType.VerticalCenter, verticalCenterTexture);
        alignTexture.Add(AlignType.Bottom, bottomTexture);
        alignTexture.Add(AlignType.Horizontal, horizontalTexture);
        alignTexture.Add(AlignType.Vertical, verticalTexture);
    }

    [MenuItem(&quot;UGUIAlign/Align&quot;)]
    public static UGUIAlignWindow GetWindow()
    {
        var window = GetWindow&lt;UGUIAlignWindow&gt;();
        window.titleContent = new GUIContent(&quot;UGUI Align&quot;);
        window.Focus();
        window.Repaint();
        return window;
    }

    void OnGUI()
    {
        GUILayout.BeginHorizontal();
        GUILayout.BeginVertical();
        for (int i = (int)AlignType.Top; i &lt;= (int)AlignType.Vertical; i++)
        {
            if (GUILayout.Button(alignTexture[(AlignType)i], &quot;LargeButton&quot;))
            {
                UGUIAlign.Align((AlignType)i);
            }
            if (i%3 == 0)
            {
                GUILayout.EndVertical();
                GUILayout.BeginVertical();
            }
        }
        GUILayout.EndVertical();
        GUILayout.EndHorizontal();
    }
}
</code></pre><h1 id="对齐图片资源"><a href="#对齐图片资源" class="headerlink" title="对齐图片资源"></a>对齐图片资源</h1><p><img src="https://img-blog.csdn.net/2018062221455923?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h1 id="Code下载"><a href="#Code下载" class="headerlink" title="Code下载"></a>Code下载</h1><p><a href="https://github.com/JingFengJi/UGUIAlign" target="_blank" rel="noopener"> https://github.com/JingFengJi/UGUIAlign</a></p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/05/13/Unity编辑器拓展之九：SearchField/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/13/Unity编辑器拓展之九：SearchField/" class="post-title-link" itemprop="url">Unity编辑器拓展之九：SearchField</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-13 18:43:35" itemprop="dateCreated datePublished" datetime="2018-05-13T18:43:35+08:00">2018-05-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:13" itemprop="dateModified" datetime="2019-03-11T22:04:13+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/05/13/Unity编辑器拓展之九：SearchField/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之九：SearchField">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<p>Unity官方介绍文档：</p>
<p><a href="https://docs.unity3d.com/ScriptReference/IMGUI.Controls.SearchField.html" target="_blank" rel="noopener"> https://docs.unity3d.com/ScriptReference/IMGUI.Controls.SearchField.html</a></p>
<h1 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h1><p>1、autoSetFocusOnFindCommand：当用户按下“Ctrl/Cmd + F”时，聚焦该控件，默认值为true<br>相关代码：</p>
<pre><code>private bool m_AutoSetFocusOnFindCommand = true;

public bool autoSetFocusOnFindCommand
{
    get
    {
        return this.m_AutoSetFocusOnFindCommand;
    }
    set
    {
        this.m_AutoSetFocusOnFindCommand = value;
    }
}

private void CommandEventHandling()
{
    Event current = Event.current;
    if (current.type == EventType.ExecuteCommand || current.type == EventType.ValidateCommand)
    {
        //UnityEngine内部应该建立了commandName与按键的对应关系
        //https://docs.unity3d.com/ScriptReference/Event-commandName.html
        if (this.m_AutoSetFocusOnFindCommand &amp;&amp; current.commandName == &quot;Find&quot;)
        {
            if (current.type == EventType.ExecuteCommand)
            {
                this.SetFocus();
            }
            current.Use();
        }
    }
}
</code></pre><p>2、searchFieldControlID<br>控件的ControllID，就不多介绍了，构造函数里会为它赋值。</p>
<h1 id="公有函数："><a href="#公有函数：" class="headerlink" title="公有函数："></a>公有函数：</h1><p>构造函数：</p>
<pre><code>public SearchField()
{
    this.m_ControlID = GUIUtility.GetPermanentControlID();
}
</code></pre><p>HasFocus：</p>
<pre><code>public bool HasFocus()
{
    return GUIUtility.keyboardControl == this.m_ControlID;
}
</code></pre><p>SetFocus：</p>
<pre><code>public void SetFocus()
{
    this.m_WantsFocus = true;
}
</code></pre><p>OnGUI<br>提供了三个重载：</p>
<pre><code>public string OnGUI(string text, params GUILayoutOption[] options);
public string OnGUI(Rect rect, string text);
public string OnGUI(Rect rect, string text, GUIStyle style, GUIStyle cancelButtonStyle, GUIStyle emptyCancelButtonStyle);


public string OnGUI(Rect rect, string text, GUIStyle style, GUIStyle cancelButtonStyle, GUIStyle emptyCancelButtonStyle)
{
    this.CommandEventHandling();
    this.FocusAndKeyHandling();
    float fixedWidth = cancelButtonStyle.fixedWidth;
    Rect position = rect;
    position.width -= fixedWidth;
    text = EditorGUI.TextFieldInternal(this.m_ControlID, position, text, style);
    Rect position2 = rect;
    position2.x += rect.width - fixedWidth;
    position2.width = fixedWidth;

    //搜索框的 X 按钮
    if (GUI.Button(position2, GUIContent.none, (!(text != &quot;&quot;)) ? emptyCancelButtonStyle : cancelButtonStyle) &amp;&amp; text != &quot;&quot;)
    {
        //搜索文字 置为 Empty，并取消其聚焦
        text = &quot;&quot;;
        GUIUtility.keyboardControl = 0;
    }
    return text;
}

public string OnGUI(Rect rect, string text)
{
    //EditorStyles.searchField = 搜索框样式
    //EditorStyles.searchFieldCancelButton= 搜索框取消按钮样式
    //EditorStyles.searchFieldCancelButtonEmpty = 搜索框 搜索关键字为空时的 样式
    return this.OnGUI(rect, text, EditorStyles.searchField, EditorStyles.searchFieldCancelButton, EditorStyles.searchFieldCancelButtonEmpty);
}

public string OnGUI(string text, params GUILayoutOption[] options)
{
    Rect rect = GUILayoutUtility.GetRect(36f, 1E+07f, 16f, 16f, EditorStyles.searchField, options);
    return this.OnGUI(rect, text);
}
</code></pre><h1 id="私有函数："><a href="#私有函数：" class="headerlink" title="私有函数："></a>私有函数：</h1><p>FocusAndKeyHandling：</p>
<pre><code>private void FocusAndKeyHandling()
{
    Event current = Event.current;
    //SetFocus公有接口将私有变量m_WantsFocus置为true，将controlID赋值给GUIUtility.keyboardControl以此实现Focus
    if (this.m_WantsFocus &amp;&amp; current.type == EventType.Repaint)
    {
        GUIUtility.keyboardControl = this.m_ControlID;
        EditorGUIUtility.editingTextField = true;
        this.m_WantsFocus = false;
    }
    if (current.type == EventType.KeyDown &amp;&amp; (current.keyCode == KeyCode.DownArrow || current.keyCode == KeyCode.UpArrow) &amp;&amp; GUIUtility.keyboardControl == this.m_ControlID &amp;&amp; GUIUtility.hotControl == 0)
    {
        if (this.downOrUpArrowKeyPressed != null)
        {
            this.downOrUpArrowKeyPressed();
            current.Use();
        }
    }
}
</code></pre><h1 id="Event："><a href="#Event：" class="headerlink" title="Event："></a>Event：</h1><p>downOrUpArrowKeyPressed：<br>搜索字段时检测到向上或者向下键被按下时，可以用来改变键盘焦点到另一个控件，例如TreeView，如下图</p>
<p><img src="https://img-blog.csdn.net/20180513181705295?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<pre><code>public event SearchField.SearchFieldCallback downOrUpArrowKeyPressed
{
    add
    {
        SearchField.SearchFieldCallback searchFieldCallback = this.downOrUpArrowKeyPressed;
        SearchField.SearchFieldCallback searchFieldCallback2;
        do
        {
            searchFieldCallback2 = searchFieldCallback;
            searchFieldCallback = Interlocked.CompareExchange&lt;SearchField.SearchFieldCallback&gt;(ref this.downOrUpArrowKeyPressed, (SearchField.SearchFieldCallback)Delegate.Combine(searchFieldCallback2, value), searchFieldCallback);
        }
        while (searchFieldCallback != searchFieldCallback2);
    }
    remove
    {
        SearchField.SearchFieldCallback searchFieldCallback = this.downOrUpArrowKeyPressed;
        SearchField.SearchFieldCallback searchFieldCallback2;
        do
        {
            searchFieldCallback2 = searchFieldCallback;
            searchFieldCallback = Interlocked.CompareExchange&lt;SearchField.SearchFieldCallback&gt;(ref this.downOrUpArrowKeyPressed, (SearchField.SearchFieldCallback)Delegate.Remove(searchFieldCallback2, value), searchFieldCallback);
        }
        while (searchFieldCallback != searchFieldCallback2);
    }
}
</code></pre><p>以上代码为使用ILSpy工具反编译得来，仅供学习使用。</p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/04/06/Unity编辑器拓展之七：如何在PreferencesWindow中新增条目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/06/Unity编辑器拓展之七：如何在PreferencesWindow中新增条目/" class="post-title-link" itemprop="url">Unity编辑器拓展之七：如何在PreferencesWindow中新增条目</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-06 15:58:23" itemprop="dateCreated datePublished" datetime="2018-04-06T15:58:23+08:00">2018-04-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:19" itemprop="dateModified" datetime="2019-03-11T22:04:19+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity/" itemprop="url" rel="index"><span itemprop="name">Unity</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/04/06/Unity编辑器拓展之七：如何在PreferencesWindow中新增条目/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之七：如何在PreferencesWindow中新增条目">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h2 id="本文介绍如何在PreferencesWindow中新增条目"><a href="#本文介绍如何在PreferencesWindow中新增条目" class="headerlink" title="本文介绍如何在PreferencesWindow中新增条目"></a>本文介绍如何在PreferencesWindow中新增条目</h2><p>在 <a href="https://blog.csdn.net/qq_26999509/article/details/79829670" target="_blank" rel="noopener"> Unity编辑器拓展之六 </a><br>中，有介绍到部分PreferencesWindow.cs的代码，而本文从源码开始给大家介绍。</p>
<p>PreferencesWindow.cs中：</p>
<pre><code>private void AddCustomSections()
{
    Assembly[] loadedAssemblies = EditorAssemblies.loadedAssemblies;
    for (int i = 0; i &lt; loadedAssemblies.Length; i++)
    {
        Assembly assembly = loadedAssemblies[i];
        Type[] typesFromAssembly = AssemblyHelper.GetTypesFromAssembly(assembly);
        Type[] array = typesFromAssembly;
        for (int j = 0; j &lt; array.Length; j++)
        {
            Type type = array[j];
            MethodInfo[] methods = type.GetMethods(BindingFlags.Static | BindingFlags.Public | BindingFlags.NonPublic);
            for (int k = 0; k &lt; methods.Length; k++)
            {
                MethodInfo methodInfo = methods[k];

                //关键在这一行
                PreferenceItem preferenceItem = Attribute.GetCustomAttribute(methodInfo, typeof(PreferenceItem)) as PreferenceItem;

                if (preferenceItem != null)
                {
                    PreferencesWindow.OnGUIDelegate onGUIDelegate = Delegate.CreateDelegate(typeof(PreferencesWindow.OnGUIDelegate), methodInfo) as PreferencesWindow.OnGUIDelegate;
                    if (onGUIDelegate != null)
                    {
                        this.m_Sections.Add(new PreferencesWindow.Section(preferenceItem.name, onGUIDelegate));
                    }
                }
            }
        }
    }
}
</code></pre><p>代码片中标注的那一行，MSDN中的介绍是：<br>“检索应用于程序集、 模块、 类型成员或方法参数的指定类型的自定义属性。”</p>
<p><a href="https://msdn.microsoft.com/zh-cn/library/system.attribute.getcustomattribute%28v=vs.110%29.aspx" target="_blank" rel="noopener"> MSDN中关于该接口的介绍 </a></p>
<p>那么，上述代码中检索了程序中使用 PreferenceItem<br>的所有method，随后将带有PreferenceItem的methodInfo实例化成一个委托，进而构造一个Section对象，添加到m_Setions集合中。</p>
<p>接着，看Unity 文档，关于 PreferenceItem 的介绍。</p>
<p><a href="https://docs.unity3d.com/2017.2/Documentation/ScriptReference/PreferenceItem.html" target="_blank" rel="noopener">https://docs.unity3d.com/2017.2/Documentation/ScriptReference/PreferenceItem.html</a></p>
<p>PreferenceItem属性允许您添加首选项到preferences窗口。</p>
<p>解释跟源码分析的一样，接下来进行代码测试。</p>
<pre><code>[PreferenceItem(&quot;Preference Item&quot;)]
private static void SelfPreferenceItem()
{
    EditorGUILayout.LabelField(&quot;Self Preference Item&quot;, EditorStyles.boldLabel);
    if (GUILayout.Button(&quot;Button&quot;))
    {
        Debug.LogError(&quot;Click&quot;);
    }
    EditorGUILayout.Space();
}
</code></pre><p><img src="https://img-blog.csdn.net/20180406153027300?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>但是，发现有点不对劲，编辑器拓展之六中提到的选中左侧，出现问题了。没有自动选中新增的那一项。</p>
<p>然后通过断点，查看到反射出来的m_Sections集合里，并没有新增的那一项，使得在遍历的时候，没法自动选中它。</p>
<p>也就是说，AddCustomSections函数在此时并没有执行到，使得新增的 “Preference Item”<br>并没有被添加到m_Sections这个集合里。</p>
<p>查看一下源码中是合适调用的 AddCustomSections函数，</p>
<pre><code>private void OnGUI()
{
    if (this.m_RefreshCustomPreferences)
    {
        this.AddCustomSections();
        this.m_RefreshCustomPreferences = false;
    }
    //节省篇幅，后面代码省略
}
</code></pre><p>也就是当m_RefreshCustomPreferences值为true时，执行一遍AddCustomSections函数。</p>
<p>完善代码：</p>
<pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEditor;
using System.Reflection;
using System;

public class OpenPreferencesWindow : EditorWindow
{
    [MenuItem(&quot;Tool/OpenPreferencesWindow&quot;)]
    public static void Open()
    {
        OpenPreferencesWindow editor = EditorWindow.GetWindow&lt;OpenPreferencesWindow&gt;();
    }

    private void OnGUI()
    {
        if (GUILayout.Button(&quot;打开PerferencesWindow&quot;))
        {
            Assembly assembly = Assembly.GetAssembly(typeof(UnityEditor.EditorWindow));
            Type type = assembly.GetType(&quot;UnityEditor.PreferencesWindow&quot;);
            type.GetMethod(&quot;ShowPreferencesWindow&quot;, BindingFlags.NonPublic | BindingFlags.Static).Invoke(null, null);

            EditorWindow window = EditorWindow.GetWindow(type);

            //解决不能自动定位 新增条目 的问题
            //手动调用一遍AddCustomSections函数
            FieldInfo refreshField = type.GetField(&quot;m_RefreshCustomPreferences&quot;, BindingFlags.NonPublic | BindingFlags.Instance);
            if ((bool)refreshField.GetValue(window))
            {
                type.GetMethod(&quot;AddCustomSections&quot;, BindingFlags.NonPublic | BindingFlags.Instance).Invoke(window, null);
                refreshField.SetValue(window, false);
            }

            FieldInfo sectionsField = type.GetField(&quot;m_Sections&quot;, BindingFlags.Instance | BindingFlags.NonPublic);
            IList sections = sectionsField.GetValue(window) as IList;

            Type sectionType = sectionsField.FieldType.GetGenericArguments()[0];
            FieldInfo sectionContentField = sectionType.GetField(&quot;content&quot;, BindingFlags.Instance | BindingFlags.Public);
            for (int i = 0; i &lt; sections.Count; i++)
            {
                GUIContent sectionContent = sectionContentField.GetValue(sections[i]) as GUIContent;
                if (sectionContent.text == &quot;Preference Item&quot;)
                {
                    FieldInfo sectionIndexField = type.GetField(&quot;m_SelectedSectionIndex&quot;, BindingFlags.Instance | BindingFlags.NonPublic);
                    sectionIndexField.SetValue(window, i);
                    return;
                }
            }
        }
    }

    [PreferenceItem(&quot;Preference Item&quot;)]
    private static void SelfPreferenceItem()
    {
        EditorGUILayout.LabelField(&quot;Self Preference Item&quot;, EditorStyles.boldLabel);
        if (GUILayout.Button(&quot;Button&quot;))
        {
            Debug.LogError(&quot;Click&quot;);
        }
        EditorGUILayout.Space();
    }
}
</code></pre><p>完美收工！</p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Mr.Ding</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">59</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.Ding</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>



  

  


  <script src="/js/src/bootstrap.js?v=7.0.1"></script>


  
  



  




  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'NNhaQgimB4QlP2E7VIp881se-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'NNhaQgimB4QlP2E7VIp881se-gzGzoHsz',
                'X-LC-Key': 'r32VGyBHt0lquCi8EGcIJlJN',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
