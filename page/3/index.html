<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="JingFengJi">
<meta property="og:url" content="https://jingfengji.github.io/page/3/index.html">
<meta property="og:site_name" content="JingFengJi">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JingFengJi">






  <link rel="canonical" href="https://jingfengji.github.io/page/3/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>JingFengJi</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JingFengJi</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2018/04/05/Unity编辑器拓展之六：利用反射打开Unity Preferences Window/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/05/Unity编辑器拓展之六：利用反射打开Unity Preferences Window/" class="post-title-link" itemprop="url">Unity编辑器拓展之六：利用反射打开Unity Preferences Window</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-05 21:54:45" itemprop="dateCreated datePublished" datetime="2018-04-05T21:54:45+08:00">2018-04-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:15" itemprop="dateModified" datetime="2019-03-11T22:04:15+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2018/04/05/Unity编辑器拓展之六：利用反射打开Unity Preferences Window/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之六：利用反射打开Unity Preferences Window">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="如何利用反射打开Unity-Preferences-Window"><a href="#如何利用反射打开Unity-Preferences-Window" class="headerlink" title="如何利用反射打开Unity Preferences Window"></a>如何利用反射打开Unity Preferences Window</h1><p>Unity Preferences Window如下图所示：</p>
<p><img src="https://img-blog.csdn.net/2018040521134474?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>作为Unity 的参数设置窗口，这个窗口支持新增项，当然本文不介绍这个内容，本次介绍如何利用反射、以及Unity<br>Editor代码来实现用代码打开Preferences Window以及设置选中项。</p>
<p>使用ILSpy工具反编译UnityEditor.dll后呢，在下图目录中的PreferencesWinndow.cs脚本</p>
<p><img src="https://img-blog.csdn.net/2018040521190433?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>里面有一个接口是”ShowPreferencesWindow”，从字面上就可以理解到是用来打开PreferencesWindow的。</p>
<pre><code>private static void ShowPreferencesWindow()
{
    EditorWindow window = EditorWindow.GetWindow&lt;PreferencesWindow&gt;(true, &quot;Unity Preferences&quot;);
    window.minSize = new Vector2(500f, 400f);
    window.maxSize = new Vector2(window.minSize.x, window.maxSize.y);
    window.position = new Rect(new Vector2(100f, 100f), window.minSize);
    window.m_Parent.window.m_DontSaveToLayout = true;
}
</code></pre><p>该函数是私有的，没办法直接调，利用反射试一下。</p>
<pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEditor;
using System.Reflection;
using System;

public class OpenPreferencesWindow : EditorWindow
{
    [MenuItem(&quot;Tool/OpenPreferencesWindow&quot;)]
    public static void Open()
    {
        OpenPreferencesWindow editor = EditorWindow.GetWindow&lt;OpenPreferencesWindow&gt;();
    }

    private void OnGUI()
    {
        if (GUILayout.Button(&quot;打开PerferencesWindow&quot;))
        {
            Assembly assembly = Assembly.GetAssembly(typeof(UnityEditor.EditorWindow));
            Type type = assembly.GetType(&quot;UnityEditor.PreferencesWindow&quot;);
            type.GetMethod(&quot;ShowPreferencesWindow&quot;, BindingFlags.NonPublic | BindingFlags.Static).Invoke(null, null);
        }
    }
}
</code></pre><p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180405213022507?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>接下来，就是如何实现在打开window之后直接选中某一项。</p>
<p>查看一下OnEnable函数，初始化里面做了啥？</p>
<pre><code>private void OnEnable()
{
    this.prefWinExtensions = ModuleManager.GetPreferenceWindowExtensions();
    this.ReadPreferences();
    this.m_Sections = new List&lt;PreferencesWindow.Section&gt;();
    this.m_Sections.Add(new PreferencesWindow.Section(&quot;General&quot;, new PreferencesWindow.OnGUIDelegate(this.ShowGeneral)));
    this.m_Sections.Add(new PreferencesWindow.Section(&quot;External Tools&quot;, new PreferencesWindow.OnGUIDelegate(this.ShowExternalApplications)));
    this.m_Sections.Add(new PreferencesWindow.Section(&quot;Colors&quot;, new PreferencesWindow.OnGUIDelegate(this.ShowColors)));
    this.m_Sections.Add(new PreferencesWindow.Section(&quot;Keys&quot;, new PreferencesWindow.OnGUIDelegate(this.ShowKeys)));
    this.m_Sections.Add(new PreferencesWindow.Section(&quot;GI Cache&quot;, new PreferencesWindow.OnGUIDelegate(this.ShowGICache)));
    this.m_Sections.Add(new PreferencesWindow.Section(&quot;2D&quot;, new PreferencesWindow.OnGUIDelegate(this.Show2D)));
    if (Unsupported.IsDeveloperBuild() || UnityConnect.preferencesEnabled)
    {
        this.m_Sections.Add(new PreferencesWindow.Section(&quot;Unity Services&quot;, new PreferencesWindow.OnGUIDelegate(this.ShowUnityConnectPrefs)));
    }
    this.m_RefreshCustomPreferences = true;
}
</code></pre><p>与PreferencesWindow图对比之后发现，m_Sections这个集合里存的Section对象应该就是Window左侧的可选项了。</p>
<p>接着看看Section这个类</p>
<pre><code>private class Section
{
    public GUIContent content;
    public PreferencesWindow.OnGUIDelegate guiFunc;
    public Section(string name, PreferencesWindow.OnGUIDelegate guiFunc)
    {
        this.content = new GUIContent(name);
        this.guiFunc = guiFunc;
    }
    public Section(string name, Texture2D icon, PreferencesWindow.OnGUIDelegate guiFunc)
    {
        this.content = new GUIContent(name, icon);
        this.guiFunc = guiFunc;
    }
    public Section(GUIContent content, PreferencesWindow.OnGUIDelegate guiFunc)
    {
        this.content = content;
        this.guiFunc = guiFunc;
    }
}
</code></pre><p>PreferencesWindow在OnEnable的时候，就有实例化几个对象，其中传入的第一个参数，例如“Colors”,就存在类的content中，那么只需要反射到这个content的，再遍历这个m_Sections，就可以实现选中左侧了。</p>
<p>完整代码，如下：</p>
<pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEditor;
using System.Reflection;
using System;

public class OpenPreferencesWindow : EditorWindow
{
    [MenuItem(&quot;Tool/OpenPreferencesWindow&quot;)]
    public static void Open()
    {
        OpenPreferencesWindow editor = EditorWindow.GetWindow&lt;OpenPreferencesWindow&gt;();
    }

    private void OnGUI()
    {
        if (GUILayout.Button(&quot;打开PerferencesWindow&quot;))
        {
            Assembly assembly = Assembly.GetAssembly(typeof(UnityEditor.EditorWindow));
            Type type = assembly.GetType(&quot;UnityEditor.PreferencesWindow&quot;);
            type.GetMethod(&quot;ShowPreferencesWindow&quot;, BindingFlags.NonPublic | BindingFlags.Static).Invoke(null, null);

            EditorWindow window = EditorWindow.GetWindow(type);

            FieldInfo sectionsField = type.GetField(&quot;m_Sections&quot;, BindingFlags.Instance | BindingFlags.NonPublic);
            IList sections = sectionsField.GetValue(window) as IList;

            Type sectionType = sectionsField.FieldType.GetGenericArguments()[0];
            FieldInfo sectionContentField = sectionType.GetField(&quot;content&quot;, BindingFlags.Instance | BindingFlags.Public);
            for (int i = 0; i &lt; sections.Count; i++)
            {
                GUIContent sectionContent = sectionContentField.GetValue(sections[i]) as GUIContent;
                if (sectionContent.text == &quot;Colors&quot;)
                {
                    FieldInfo sectionIndexField = type.GetField(&quot;m_SelectedSectionIndex&quot;, BindingFlags.Instance | BindingFlags.NonPublic);
                    sectionIndexField.SetValue(window, i);
                    return;
                }
            }
        }
    }
}
</code></pre><p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180405215336898?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI2OTk5NTA5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p>如果插件中有在PreferencesWindow中添加项，就可以通过这个让用户快捷打开了。</p>
<p>通过这篇文章，希望可以帮助大家学会如何分析反编译出的代码，分析UnityEditor如何实现的编辑器，以此来写出更加实用的插件</p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2017/12/28/Unity编辑器拓展之五：修改脚本icon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/28/Unity编辑器拓展之五：修改脚本icon/" class="post-title-link" itemprop="url">Unity编辑器拓展之五：修改脚本icon</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-12-28 00:15:40" itemprop="dateCreated datePublished" datetime="2017-12-28T00:15:40+08:00">2017-12-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 21:56:51" itemprop="dateModified" datetime="2019-03-11T21:56:51+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/12/28/Unity编辑器拓展之五：修改脚本icon/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之五：修改脚本icon">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<p>Unity修改脚本在Project面板中显示的icon有两种方法，<br>先看示意图：<br><img src="https://img-blog.csdn.net/20171228000919910?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>方法1：修改脚本的meta文件<br>脚本的 meta文件默认如下所示：</p>
<p><img src="https://img-blog.csdn.net/20171228001130631?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>注意到，图中的icon，填的“instanceID = 0”即为默认显示</p>
<p>在里面填入icon文件的fileid和guid，如下所示，即可实现。</p>
<p><img src="https://img-blog.csdn.net/20171228001038478?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>方法二：简单粗暴，Unity直接可以设置。。。</p>
<p><img src="https://img-blog.csdn.net/20171228001444719?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2017/11/12/Unity编辑器拓展之四：ConsoleWindow中的双击日志定位/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/11/12/Unity编辑器拓展之四：ConsoleWindow中的双击日志定位/" class="post-title-link" itemprop="url">Unity编辑器拓展之四：ConsoleWindow中的双击日志定位</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-12 23:21:54" itemprop="dateCreated datePublished" datetime="2017-11-12T23:21:54+08:00">2017-11-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:55" itemprop="dateModified" datetime="2019-03-11T22:04:55+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/11/12/Unity编辑器拓展之四：ConsoleWindow中的双击日志定位/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之四：ConsoleWindow中的双击日志定位">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<p>原文地址： <a href="http://blog.csdn.net/l449612236/article/details/76087616" target="_blank" rel="noopener"> http://blog.csdn.net/l449612236/article/details/76087616</a></p>
<p>感谢上位博主的分享。</p>
<p>本文在此基础上，做了分析加上了更加详细的介绍。</p>
<p>新建LogEditor脚本<br>直接上源码以及注释：</p>
<pre><code>using System.Reflection;
using UnityEditor;
using UnityEngine;

public class LogEditor 
{
    private class LogEditorConfig
    {
        public string logScriptPath = &quot;&quot;;   //自定义日志脚本路径
        public string logTypeName = &quot;&quot;;     //脚本type
        public int instanceID = 0;

        public LogEditorConfig(string logScriptPath, System.Type logType)
        {
            this.logScriptPath = logScriptPath;
            this.logTypeName = logType.FullName;
        }
    }

    //配置的日志
    private static LogEditorConfig[] _logEditorConfig = new LogEditorConfig[]
    {
        new LogEditorConfig(&quot;Assets/Scripts/DDebug/DDebug.cs&quot;,typeof(DDebug))
    };

    //处理从ConsoleWindow双击跳转
    [UnityEditor.Callbacks.OnOpenAssetAttribute(-1)]
    private static bool OnOpenAsset(int instanceID,int line)
    {
        for (int i = _logEditorConfig.Length - 1; i &gt;= 0; --i)
        {
            var configTmp = _logEditorConfig[i];
            UpdateLogInstanceID(configTmp);
            if (instanceID == configTmp.instanceID)
            {
                var statckTrack = GetStackTrace();
                if (!string.IsNullOrEmpty(statckTrack))
                {
                    /*
                    举例说明：下面这段是一条ConsoleWindow的日志信息
                    Awake
                    UnityEngine.Debug:Log(Object)
                    DDebug:Log(String) (at Assets/Scripts/DDebug/DDebug.cs:13)
                    Test:Awake() (at Assets/Scripts/Test.cs:13)

                    说明：
                    1、其中第一行的&quot;Awake&quot;:是指调用自定义打印日志函数的函数名，本例是在Test脚本中的Awake函数里调用的
                    2、第二行的&quot;UnityEngine.Debug:Log(Object)&quot;:是指该日志最底层是通过Debug.Log函数打印出来的
                    3、第三行的&quot;DDebug:Log(String) (at Assets/Scripts/DDebug/DDebug.cs:13)&quot;:指第二行的函数调用在DDebug.cs的13行
                    4、第四行的&quot;Test:Awake() (at Assets/Scripts/Test.cs:13)&quot;:指Test.cs脚本的Awake函数调用了第二行的DDebug.cs的Log函数，在第13行
                     */

                    //通过以上信息，不难得出双击该日志应该打开Test.cs文件，并定位到第13行
                    //以换行分割堆栈信息
                    var fileNames = statckTrack.Split(&apos;\n&apos;);
                    //定位到调用自定义日志函数的那一行：&quot;Test:Awake() (at Assets/Scripts/Test.cs:13)&quot;
                    var fileName = GetCurrentFullFileName(fileNames);
                    //定位到上例的行数：13
                    var fileLine = LogFileNameToFileLine(fileName);
                    //得到调用自定义日志函数的脚本：&quot;Assets/Scripts/Test.cs&quot;
                    fileName = GetRealFileName(fileName);

                    //根据脚本名和行数，打开脚本
                    //&quot;Assets/Scripts/Test.cs&quot;
                    //13
                    AssetDatabase.OpenAsset(AssetDatabase.LoadAssetAtPath&lt;UnityEngine.Object&gt;(fileName), fileLine);
                    return true;
                }
                break;
            }
        }

        return false;
    }

    /// &lt;summary&gt;
    /// 反射出日志堆栈
    /// &lt;/summary&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    private static string GetStackTrace()
    {
        var consoleWindowType = typeof(EditorWindow).Assembly.GetType(&quot;UnityEditor.ConsoleWindow&quot;);
        var fieldInfo = consoleWindowType.GetField(&quot;ms_ConsoleWindow&quot;, BindingFlags.Static | BindingFlags.NonPublic);
        var consoleWindowInstance = fieldInfo.GetValue(null);

        if (null != consoleWindowInstance)
        {
            if ((object)EditorWindow.focusedWindow == consoleWindowInstance)
            {
                fieldInfo = consoleWindowType.GetField(&quot;m_ActiveText&quot;, BindingFlags.Instance | BindingFlags.NonPublic);
                string activeText = fieldInfo.GetValue(consoleWindowInstance).ToString();
                return activeText;
            }
        }
        return &quot;&quot;;
    }

    private static void UpdateLogInstanceID(LogEditorConfig config)
    {
        if (config.instanceID &gt; 0)
        {
            return;
        }

        var assetLoadTmp = AssetDatabase.LoadAssetAtPath&lt;UnityEngine.Object&gt;(config.logScriptPath);
        if (null == assetLoadTmp)
        {
            throw new System.Exception(&quot;not find asset by path=&quot; + config.logScriptPath);
        }
        config.instanceID = assetLoadTmp.GetInstanceID();
    }

    private static string GetCurrentFullFileName(string[] fileNames)
    {
        string retValue = &quot;&quot;;
        int findIndex = -1;

        for (int i = fileNames.Length - 1; i &gt;= 0; --i)
        {
            bool isCustomLog = false;
            for (int j = _logEditorConfig.Length - 1; j &gt;= 0; --j)
            {
                if (fileNames[i].Contains(_logEditorConfig[j].logTypeName))
                {
                    isCustomLog = true;
                    break;
                }
            }
            if (isCustomLog)
            {
                findIndex = i;
                break;
            }
        }

        if (findIndex &gt;= 0 &amp;&amp; findIndex &lt; fileNames.Length - 1)
        {
            retValue = fileNames[findIndex + 1];
        }

        return retValue;
    }

    private static string GetRealFileName(string fileName)
    {
        int indexStart = fileName.IndexOf(&quot;(at &quot;) + &quot;(at &quot;.Length;
        int indexEnd = ParseFileLineStartIndex(fileName) - 1;

        fileName = fileName.Substring(indexStart, indexEnd - indexStart);
        return fileName;
    }

    private static int LogFileNameToFileLine(string fileName)
    {
        int findIndex = ParseFileLineStartIndex(fileName);
        string stringParseLine = &quot;&quot;;
        for (int i = findIndex; i &lt; fileName.Length; ++i)
        {
            var charCheck = fileName[i];
            if (!IsNumber(charCheck))
            {
                break;
            }
            else
            {
                stringParseLine += charCheck;
            }
        }

        return int.Parse(stringParseLine);
    }

    private static int ParseFileLineStartIndex(string fileName)
    {
        int retValue = -1;
        for (int i = fileName.Length - 1; i &gt;= 0; --i)
        {
            var charCheck = fileName[i];
            bool isNumber = IsNumber(charCheck);
            if (isNumber)
            {
                retValue = i;
            }
            else
            {
                if (retValue != -1)
                {
                    break;
                }
            }
        }
        return retValue;
    }

    private static bool IsNumber(char c)
    {
        return c &gt;= &apos;0&apos; &amp;&amp; c &lt;= &apos;9&apos;;
    }
}
</code></pre><p>该脚本放置在工程目录下的Editor文件夹中。</p>
<p>接着实现自己的日志类，我这里取名为DDebug类。<br>我之前也介绍过一篇文章，实现自己的Debug类<br>地址如下： <a href="http://blog.csdn.net/qq_26999509/article/details/53643564" target="_blank" rel="noopener"> http://blog.csdn.net/qq_26999509/article/details/53643564</a></p>
<p>当初写的不够成熟，大家可以按照自己意愿进行编写。<br>本次主要是为了实现双击日志定位的功能。</p>
<p>下面附上本次测试写的DDebug脚本：</p>
<pre><code>using UnityEngine;

public class DDebug 
{
    static private string errorColor = &quot;red&quot;;

    static private string warningColor = &quot;yellow&quot;;

    static private string logColor = &quot;white&quot;;

    public static void Log(string info)
    {
        info = string.Concat(&quot;&lt;color=&quot;, logColor, &quot;&gt;&quot;, info, &quot;&lt;/color&gt;&quot;);
        Debug.Log(info);
    }

    public static void LogError(string info)
    {
        info = string.Concat(&quot;&lt;color=&quot;, errorColor, &quot;&gt;&quot;, info, &quot;&lt;/color&gt;&quot;);
        Debug.LogError(info);
    }

    public static void LogWarning(string info)
    {
        info = string.Concat(&quot;&lt;color=&quot;, warningColor, &quot;&gt;&quot;, info, &quot;&lt;/color&gt;&quot;);
        Debug.LogWarning(info);
    }
}
</code></pre><p>这里只是加了颜色而已，其实还有不少功能可以拓展。</p>
<p>接下来写个Test测试脚本，进行代码测试。</p>
<pre><code>using UnityEngine;

public class Test : MonoBehaviour 
{
    private void OnEnable()
    {
        DDebug.LogWarning(&quot;OnEnable&quot;);
    }

    void Awake()
    {
        DDebug.Log(&quot;Awake&quot;);
    }

    void Start () 
    {
        DDebug.LogError(&quot;Start&quot;);
    }
}
</code></pre><p>将该脚本挂在场景中。</p>
<p>测试如下：</p>
<p><img src="https://img-blog.csdn.net/20171112231731303?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>双击日志也能成功跳转到日志函数调用的地方。。测试通过。</p>
<p>最后附上工程地址：<br>链接： <a href="http://pan.baidu.com/s/1c2La0hy" target="_blank" rel="noopener"> http://pan.baidu.com/s/1c2La0hy </a><br>密码：ibqb</p>
<p>再次补充，原文地址： <a href="http://blog.csdn.net/l449612236/article/details/76087616" target="_blank" rel="noopener"> http://blog.csdn.net/l449612236/article/details/76087616</a></p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2017/11/07/Unity插件推荐/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/11/07/Unity插件推荐/" class="post-title-link" itemprop="url">Unity插件推荐</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-07 00:11:54" itemprop="dateCreated datePublished" datetime="2017-11-07T00:11:54+08:00">2017-11-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:05:03" itemprop="dateModified" datetime="2019-03-11T22:05:03+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2017/11/07/Unity插件推荐/" class="leancloud_visitors" data-flag-title="Unity插件推荐">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h3 id="一、可视化PlayerPrefs"><a href="#一、可视化PlayerPrefs" class="headerlink" title="一、可视化PlayerPrefs"></a>一、可视化PlayerPrefs</h3><p>Advanced PlayerPrefs Window插件是一款PlayerPrefs数据的可视化管理插件</p>
<p>下载地址： <a href="http://www.taidous.com/forum.php?mod=viewthread&amp;tid=59744&amp;highlight=PlayerPrefs" target="_blank" rel="noopener">http://www.taidous.com/forum.php?mod=viewthread&amp;tid=59744&amp;highlight=PlayerPrefs</a></p>
<p>或者链接： <a href="http://pan.baidu.com/s/1bpg0AYF" target="_blank" rel="noopener"> http://pan.baidu.com/s/1bpg0AYF </a><br>密码：w9vm</p>
<p>插件界面如下图所示：</p>
<p><img src="https://img-blog.csdn.net/20171106235922648?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h4 id="插件代码分析："><a href="#插件代码分析：" class="headerlink" title="插件代码分析："></a>插件代码分析：</h4><p>至于编辑器的代码就不解释了，主要来看一下该插件是如何获取到工程里关于PlayerPrefs数据的所有的key 的。<br>先看一下官方文档中关于PlayerPrefs的解释：<br><a href="https://docs.unity3d.com/2017.2/Documentation/ScriptReference/PlayerPrefs.html" target="_blank" rel="noopener">https://docs.unity3d.com/2017.2/Documentation/ScriptReference/PlayerPrefs.html</a></p>
<p>其中</p>
<p><img src="https://img-blog.csdn.net/20171107000252250?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>从图中可以看出Unity将这些数据在各平台下存储的位置，以Windows为例，其数据存储在注册表中的</p>
<p>HKCU/Software[company name][product name]中</p>
<p>下面是截图：<br><img src="https://img-blog.csdn.net/20171107000710134?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>图中可见该工程包含了5个key，其中UnityGraphicsQuality是Unity工程自带的。</p>
<p>下面上一段该插件从注册表中获取key的代码（Windows平台的）</p>
<pre><code>        private string[] GetAllWindowsKeys()
        {
            RegistryKey cuKey = Registry.CurrentUser;
            RegistryKey unityKey;

            //The default location of PlayerPrefs pre Unity 5_5
#if UNITY_5_5_OR_NEWER
            unityKey = cuKey.CreateSubKey(&quot;Software\\Unity\\UnityEditor\\&quot; + PlayerSettings.companyName + &quot;\\&quot; + PlayerSettings.productName);
#else
            unityKey = cuKey.CreateSubKey(&quot;Software\\&quot; + PlayerSettings.companyName + &quot;\\&quot; + PlayerSettings.productName);

            if (unityKey.GetValueNames().Length == 0)
            {
                //On some machines (Windows 7 &amp; 8 64bit using Unity5.4) PlayersPrefs are saved in HKEY_CURRENT_USER\SOFTWARE\AppDataLow\Software\CompanyName\ProjectName weird enough...
                unityKey = cuKey.CreateSubKey(&quot;Software\\AppDataLow\\Software\\&quot; + PlayerSettings.companyName + &quot;\\&quot; + PlayerSettings.productName);
            }
#endif

            string[] values = unityKey.GetValueNames();
            for (int i = 0; i &lt; values.Length; i++)
            {
                values[i] = values[i].Substring(0, values[i].LastIndexOf(&quot;_&quot;));
            }

            return values;
        }
</code></pre><p>代码不一一解释了，关于RegistryKey类和Registry类查看一下MSDN：<br><a href="https://msdn.microsoft.com/zh-cn/library/microsoft.win32.registrykey\(v=vs.110\" target="_blank" rel="noopener"> https://msdn.microsoft.com/zh-cn/library/microsoft.win32.registrykey(v=vs.110).aspx</a>.aspx)<br><a href="https://msdn.microsoft.com/zh-cn/library/microsoft.win32.registry\(v=vs.110\" target="_blank" rel="noopener"> https://msdn.microsoft.com/zh-cn/library/microsoft.win32.registry(v=vs.110).aspx</a>.aspx)</p>
<p>以上知识分享，步骤详细，如有错误，欢迎指出，共同学习，共同进步</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2017/11/04/Unity&Android之二：获取手机电量信息、网络状况/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/11/04/Unity&Android之二：获取手机电量信息、网络状况/" class="post-title-link" itemprop="url">Unity&Android之二：获取手机电量信息、网络状况</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-04 16:12:19" itemprop="dateCreated datePublished" datetime="2017-11-04T16:12:19+08:00">2017-11-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:03:34" itemprop="dateModified" datetime="2019-03-11T22:03:34+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2017/11/04/Unity&Android之二：获取手机电量信息、网络状况/" class="leancloud_visitors" data-flag-title="Unity&Android之二：获取手机电量信息、网络状况">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="Unity-amp-Android之二：获取手机电量信息、网络状况"><a href="#Unity-amp-Android之二：获取手机电量信息、网络状况" class="headerlink" title="Unity&amp;Android之二：获取手机电量信息、网络状况"></a>Unity&amp;Android之二：获取手机电量信息、网络状况</h1><p>游戏中经常会在UI显示电量以及网络状况</p>
<p>手机电量包括：<br>1、当前正在充电还是放电<br>2、当前电量值</p>
<p>网络包括：<br>1、如果是WIFI，WIFI信号强度<br>2、如果是流量，信号强度等数据</p>
<p>例如王者荣耀中右上角所示<br><img src="https://img-blog.csdn.net/20171104150659066?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>那么接下来就介绍一下如何实现获取手机电量信息以及网络状况等数据。</p>
<h4 id="1、打开Eclipse建一个安卓库工程，注意是库工程"><a href="#1、打开Eclipse建一个安卓库工程，注意是库工程" class="headerlink" title="1、打开Eclipse建一个安卓库工程，注意是库工程"></a>1、打开Eclipse建一个安卓库工程，注意是库工程</h4><p><img src="https://img-blog.csdn.net/20171104151235368?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h4 id="这里注意一下包名"><a href="#这里注意一下包名" class="headerlink" title="这里注意一下包名"></a>这里注意一下包名</h4><p><img src="https://img-blog.csdn.net/20171104151506838?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><img src="https://img-blog.csdn.net/20171104151651454?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>Icon显示方式选择，默认即可</p>
<p><img src="https://img-blog.csdn.net/20171104151745185?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>选择一个空的activity</p>
<p><img src="https://img-blog.csdn.net/20171104151831195?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>安卓Activity名称，默认即可，Finish</p>
<p><img src="https://img-blog.csdn.net/20171104151909255?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>创建完之后，就会得到这样一个工程</p>
<p><img src="https://img-blog.csdn.net/20171104152012704?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>至于目录结构，请自行补充相关知识</p>
<p>工程创建好，此时安卓还无法与Unity进行交互，需要为工程导入一个Unity提供的classes.jar，该文件在Unity的安装目录下</p>
<p><img src="https://img-blog.csdn.net/20171104152233437?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>将该jar文件导入到工程目录下的libs文件夹中，鼠标选中工程根目录</p>
<p><img src="https://img-blog.csdn.net/20171104152504759?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>准备工作完成之后，就可以开始编写代码了。</p>
<p>修改MainActivity.java类的父类为UnityPlayerActivity</p>
<p>该类需要import相关的包</p>
<pre><code>import com.unity3d.player.UnityPlayerActivity;
</code></pre><p>删除onCreate函数中的</p>
<pre><code>setContentView(R.layout.activity_main);
</code></pre><p>至此，MainActivity.java文件代码如下：</p>
<pre><code>package com.unityplugin.phonepower;

import com.unity3d.player.UnityPlayerActivity;

import android.os.Bundle;
import android.app.Activity;
import android.view.Menu;

public class MainActivity extends UnityPlayerActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    }


    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.main, menu);
        return true;
    }

}
</code></pre><p>接下来编写函数以供Unity调用</p>
<p>完整代码如下：</p>
<pre><code>package com.unityplugin.phonepower;

import com.unity3d.player.UnityPlayerActivity;

import android.net.wifi.WifiInfo;
import android.net.wifi.WifiManager;
import android.os.Bundle;
import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.view.Menu;

public class MainActivity extends UnityPlayerActivity {

    private static Context instance;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        instance = getApplication();
    }


    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.main, menu);
        return true;
    }

    //获取手机当前电量、总电量（默认其实都是100）、当前状态（充电还是放电）
    //其余数据例如电压、电池温度用的较少
    public String MonitorBatteryState()
    {
        IntentFilter iFilter = new IntentFilter(Intent.ACTION_BATTERY_CHANGED);
        Intent intent = instance.registerReceiver(null, iFilter);
        int rawLevel = intent.getIntExtra(&quot;level&quot;, 0);      //获得当前电量
        int scale = intent.getIntExtra(&quot;scale&quot;, 0);         //获得总电量
        int status = intent.getIntExtra(&quot;status&quot;, 0);       //电池充电状态
        int health = intent.getIntExtra(&quot;voltage&quot;, 0);      //电池健康状况
        int batteryV = intent.getIntExtra(&quot;voltage&quot;, 0);    //电池电压(mv)
        int temperature = intent.getIntExtra(&quot;temperature&quot;, 0); //电池温度(数值)
        double t = temperature / 10.0;  //电池摄氏温度，默认获取的非摄氏温度值，需做一下运算转换
        String targetStr = &quot;&quot;;
        int level = -1;
        if(rawLevel &gt; 0 &amp;&amp; scale &gt; 0)
        {
            level = (rawLevel * 100) / scale;
            targetStr = level + &quot;|&quot; + scale + &quot;|&quot; + status;
        }
        return targetStr;
    }

    //获取Wifi信号强度
    @SuppressWarnings(&quot;deprecation&quot;)
    private String ObtainWifiInfo()
    {
        String result = &quot;&quot;;
        WifiManager wifiManager = (WifiManager)getApplication().getSystemService(WIFI_SERVICE);
        WifiInfo info = wifiManager.getConnectionInfo();
        if(info.getBSSID() != null)
        {
            //链接信号强度
            int strength = WifiManager.calculateSignalLevel(info.getRssi(), 5);
            //链接速度
            int speed = info.getLinkSpeed();
            //链接速度单位
            String units = WifiInfo.LINK_SPEED_UNITS;
            //Wifi源名称
            String ssid = info.getSSID();
            int ip = info.getIpAddress();
            String mac = info.getMacAddress();
            result = strength + &quot;|&quot; + IntToIp(ip) + &quot;|&quot; + mac + &quot;|&quot; + ssid;
        }
        return result;
    }

    private String IntToIp(int paramInt)
    {
        return (paramInt &amp; 0xFF) + &quot;.&quot; + (0xFF &amp; paramInt &gt;&gt; 8) + &quot;.&quot; + (0xFF &amp; paramInt &gt;&gt; 16) + &quot;.&quot; + (0xFF &amp; paramInt &gt;&gt; 24);
    }
}
</code></pre><p>代码编写完之后，还有一件重要的事情，那就是手机权限。<br>访问手机电量，不需要权限，不过WIFI状况需要添加一个权限。</p>
<h3 id="如何添加权限"><a href="#如何添加权限" class="headerlink" title="如何添加权限"></a>如何添加权限</h3><p>双击AndroidManifest.xml文件<br><img src="https://img-blog.csdn.net/20171104153826100?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>点击Add按钮添加权限</p>
<p><img src="https://img-blog.csdn.net/20171104153911163?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>选中最后一项Uses Permission</p>
<p>添加Name为android.permission.ACCESS_WIFI_STATE的权限</p>
<p><img src="https://img-blog.csdn.net/20171104154000967?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h3 id="记得保存该文件！"><a href="#记得保存该文件！" class="headerlink" title="记得保存该文件！"></a>记得保存该文件！</h3><p>权限弄完之后即可到处jar包到Unity工程中了。</p>
<p><img src="https://img-blog.csdn.net/20171104154131855?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><img src="https://img-blog.csdn.net/20171104154205290?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><img src="https://img-blog.csdn.net/20171104154304138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>jar导出后，就可以创建一个Unity工程，进行测试了。</p>
<p>创建一个Plugins/Android的文件夹，该文件夹用来 存放安卓插件的。</p>
<p>将Android工程中的Libs、Res、AndroidMainFest.xml文件拷贝过来，如下：<br><img src="https://img-blog.csdn.net/20171104154629294?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>接下来编写测试代码：</p>
<p>在场景中创建一个Button（用来点击从安卓那边获取数据）和两个text（分别用来显示电量数据和wifi数据），并创建一个test脚本</p>
<p><img src="https://img-blog.csdn.net/20171104155525241?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>脚本代码如下：</p>
<pre><code>using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class Test : MonoBehaviour 
{
    public Button button;
    public Text phonePowerText;
    public Text wifiText;

    private string batteryData;
    private string wifiData;

    void Awake()
    {
        button.onClick.AddListener(OnButtonClicked);
    }

    private void OnButtonClicked()
    {
        AndroidJavaClass jc = new AndroidJavaClass(&quot;com.unity3d.player.UnityPlayer&quot;);
        AndroidJavaObject jo = jc.GetStatic&lt;AndroidJavaObject&gt;(&quot;currentActivity&quot;);
        batteryData = jo.Call&lt;string&gt;(&quot;MonitorBatteryState&quot;);
        wifiData = jo.Call&lt;string&gt;(&quot;ObtainWifiInfo&quot;);
        OnBatteryDataBack(batteryData);
        OnWifiDataBack(wifiData);
    }

    //安卓那边将数据以“|”进行分割，所以这边以&quot;|&quot;来分割数据
    private void OnBatteryDataBack(string data)
    {
        phonePowerText.text = &quot;&quot;;
        string[] args = data.Split(&apos;|&apos;);
        if (args[2] == &quot;2&quot;)
        {
            phonePowerText.text += &quot;电池充电中\n&quot;;
        }
        else
        {
            phonePowerText.text += &quot;电池放电中\n&quot;;
        }
        int curPower = int.Parse(args[0]);
        float power = float.Parse(args[1]);
        float percent = curPower / power;
        phonePowerText.text += &quot; cur power:&quot; + curPower;
        phonePowerText.text += &quot;  all power:&quot; + power;
        phonePowerText.text += &quot; 电量比例：&quot; + (Mathf.CeilToInt(percent * 100) + &quot;%&quot;).ToString();
    }

    private void OnWifiDataBack(string data)
    {
        wifiText.text = &quot;&quot;;
        wifiText.text += wifiData;
        string[] args = wifiData.Split(&apos;|&apos;);
        int wifiLevel = int.Parse(args[0]);
        wifiText.text += &quot;Wifi信号格数：&quot; + wifiLevel.ToString() + &quot;\n&quot;;
        string ip = &quot;IP：&quot; + args[1] + &quot;\n&quot;;
        string mac = &quot;MAC:&quot; + args[2] + &quot;\n&quot;;
        string ssid = &quot;Wifi Name:&quot; + args[3] + &quot;\n&quot;;
        wifiText.text += ip;
        wifiText.text += mac;
        wifiText.text += ssid;
    }
}
</code></pre><p>记得将工程平台切换成Android</p>
<p>最后设置PlayerSettings，</p>
<p><img src="https://img-blog.csdn.net/20171104155855294?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>可以build成apk了。</p>
<p>测试截图：</p>
<p><img src="https://img-blog.csdn.net/20171104160949446?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>从图中可以看出<br>当前手机正在充电，并且电量为60，至于图中的61属于浮点类型数据的运算带来的精度问题，不过这点问题在应用中不足为虑。<br>而wifi状况则是，四格信号，都是正常的。</p>
<p>抱歉，IP地址被我打码了。</p>
<p>以上知识分享，步骤详细，如有错误，欢迎指出，共同学习，共同进步</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2017/11/04/Unity&Android之一：手机震动/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/11/04/Unity&Android之一：手机震动/" class="post-title-link" itemprop="url">Unity&Android之一：手机震动</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-04 00:06:42" itemprop="dateCreated datePublished" datetime="2017-11-04T00:06:42+08:00">2017-11-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:03:37" itemprop="dateModified" datetime="2019-03-11T22:03:37+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2017/11/04/Unity&Android之一：手机震动/" class="leancloud_visitors" data-flag-title="Unity&Android之一：手机震动">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="Unity调用手机震动"><a href="#Unity调用手机震动" class="headerlink" title="Unity调用手机震动"></a>Unity调用手机震动</h1><p>在游戏中，有时为了增加游戏的打击感，会使用手机震动。关于手机震动其实很简单。</p>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>Unity中提供了一个接口</p>
<pre><code>Handheld.Vibrate();
</code></pre><p>该接口无需做平台判断。<br>官方介绍：Triggers device vibration.<br>翻译就是指触发装置振动。<br><a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Handheld.Vibrate.html" target="_blank" rel="noopener">https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Handheld.Vibrate.html</a></p>
<p>该接口无法为振动设置时长、频率等。如有需要，安卓则需要通过获取系统服务后开启振动</p>
<pre><code>public void Shake()
    {
        Activity curActivity = UnityPlayer.currentActivity;
        m_vibrator = (Vibrator)curActivity.getSystemService(Service.VIBRATOR_SERVICE);
        m_vibrator.vibrate(new long[]{100,10,100,1000},-1);
    }
</code></pre><p>详情参考：<br><a href="http://www.cnblogs.com/android-blogs/p/6381850.html" target="_blank" rel="noopener"> http://www.cnblogs.com/android-blogs/p/6381850.html </a></p>
<p>如果只是简单的使用，Unity 提供的接口已经够了。。</p>
<h4 id="请在真机下进行测试"><a href="#请在真机下进行测试" class="headerlink" title="请在真机下进行测试"></a>请在真机下进行测试</h4><p>最近正在补充Unity跟Android交互相关的知识，包括接入SDK、游戏中使用二维码等</p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2017/09/16/Unity编辑器拓展之三：拓展Unity的Hierarchy面板/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/16/Unity编辑器拓展之三：拓展Unity的Hierarchy面板/" class="post-title-link" itemprop="url">Unity编辑器拓展之三：拓展Unity的Hierarchy面板</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-09-16 21:58:42" itemprop="dateCreated datePublished" datetime="2017-09-16T21:58:42+08:00">2017-09-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:04:22" itemprop="dateModified" datetime="2019-03-11T22:04:22+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/09/16/Unity编辑器拓展之三：拓展Unity的Hierarchy面板/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之三：拓展Unity的Hierarchy面板">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20170916213433810?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>上图中在Hierarchy右侧绘制了Toggle，Label，以及自定义的texture和Unity原声的Texture，知道了原理，其实这些都很简单。。</p>
<p>这里主要是使用了EditorApplication类下的HierarchyWindowItemCallback类型的hierarchyWindowItemOnGUI</p>
<pre><code>//
// 摘要:
//     ///
//     Delegate to be called for every visible list item in the HierarchyWindow on every
//     OnGUI event.
//     ///
//
// 参数:
//   instanceID:
//
//   selectionRect:
public delegate void HierarchyWindowItemCallback(int instanceID, Rect selectionRect);
</code></pre><p>该委托有两个参数，一个是int类型的instanceID，通过该ID利用EditorUtility.InstanceIDToObject(instanceID)可以获取该GameObject，然后第二个参数Rect，也就是该物体在Hierarchy面板的位置信息了，通过这两个数据，在Hierarchy面板上拓展就很简单了。</p>
<pre><code>using System;
using System.Collections;
using System.Collections.Generic;
using UnityEditor;
using UnityEngine;
using UnityEngine.Networking;
using UnityEngine.UI;

[InitializeOnLoad]
public class HierachyIconManager
{
    // 层级窗口项回调
    private static readonly EditorApplication.HierarchyWindowItemCallback hiearchyItemCallback;

    private static Texture2D hierarchyIcon;
    private static Texture2D HierarchyIcon
    {
        get
        {
            if (HierachyIconManager.hierarchyIcon == null)
            {
                HierachyIconManager.hierarchyIcon = (Texture2D)Resources.Load(&quot;icon_1&quot;);
            }
            return HierachyIconManager.hierarchyIcon;
        }
    }

    /// &lt;summary&gt;
    /// 静态构造
    /// &lt;/summary&gt;
    static HierachyIconManager()
    {
        HierachyIconManager.hiearchyItemCallback = new EditorApplication.HierarchyWindowItemCallback(HierachyIconManager.DrawHierarchyIcon);
        EditorApplication.hierarchyWindowItemOnGUI = (EditorApplication.HierarchyWindowItemCallback)Delegate.Combine(
            EditorApplication.hierarchyWindowItemOnGUI,
            HierachyIconManager.hiearchyItemCallback);

        //EditorApplication.update += Update;
    }

    // 绘制icon方法
    private static void DrawHierarchyIcon(int instanceID, Rect selectionRect)
    {
        Rect rectCheck = new Rect(selectionRect);
        rectCheck.x += rectCheck.width - 20;
        rectCheck.width = 18;
        GameObject go = EditorUtility.InstanceIDToObject(instanceID) as GameObject;
        go.SetActive(GUI.Toggle(rectCheck, go.activeSelf, string.Empty));

        var index = 0;
        GUIStyle style = null;
        if (go.isStatic)
        {
            index += 1;
            Rect rectIcon = GetRect(selectionRect, index);
            GUI.Label(rectIcon, &quot;S&quot;);
        }

        // 文字颜色定义 
        var colorMesh = new Color(42 / 255f, 210 / 255f, 235 / 255f);
        var colorSkinMesh = new Color(0.78f, 0.35f, 0.78f);
        var colorLight = new Color(251 / 255f, 244 / 255f, 124 / 255f);
        var colorPhysic = new Color(0.35f, 0.75f, 0f);
        var colorCollider = new Color(0.35f, 0.75f, 0.196f);
        var colorAnimation = new Color(175 / 255f, 175 / 255f, 218 / 255f);
        var colorCamera = new Color(111 / 255f, 121 / 255f, 212 / 255f);
        var colorParticle = new Color(130 / 255f, 124 / 255f, 251 / 255f);
        var colorNav = new Color(217 / 255f, 80 / 255f, 62 / 255f);
        var colorNetwork = new Color(42 / 255f, 129 / 255f, 235 / 255f);
        var colorAudio = new Color(255 / 255f, 126 / 255f, 0f);

        DrawRectIcon(selectionRect,HierarchyIcon,ref index);


        DrawRectIcon&lt;MeshRenderer&gt;(selectionRect, go, colorMesh, ref index, ref style);
        DrawRectIcon&lt;SkinnedMeshRenderer&gt;(selectionRect, go, colorSkinMesh, ref index, ref style);

        // Colliders
        DrawRectIcon&lt;BoxCollider&gt;(selectionRect, go, colorCollider, ref index, ref style);
        DrawRectIcon&lt;SphereCollider&gt;(selectionRect, go, colorCollider, ref index, ref style);
        DrawRectIcon&lt;CapsuleCollider&gt;(selectionRect, go, colorCollider, ref index, ref style);
        DrawRectIcon&lt;MeshCollider&gt;(selectionRect, go, colorCollider, ref index, ref style);
        DrawRectIcon&lt;CharacterController&gt;(selectionRect, go, colorCollider, ref index, ref style);

        // RigidBody
        DrawRectIcon&lt;Rigidbody&gt;(selectionRect, go, colorPhysic, ref index, ref style);

        // Lights
        DrawRectIcon&lt;Light&gt;(selectionRect, go, colorLight, ref index, ref style);

        // Joints

        // Animation / Animator
        DrawRectIcon&lt;Animator&gt;(selectionRect, go, colorAnimation, ref index, ref style);
        DrawRectIcon&lt;Animation&gt;(selectionRect, go, colorAnimation, ref index, ref style);

        // Camera / Projector
        DrawRectIcon&lt;Camera&gt;(selectionRect, go, colorCamera, ref index, ref style);
        DrawRectIcon&lt;Projector&gt;(selectionRect, go, colorCamera, ref index, ref style);

        // NavAgent
        DrawRectIcon&lt;UnityEngine.AI.NavMeshAgent&gt;(selectionRect, go, colorNav, ref index, ref style);
        DrawRectIcon&lt;UnityEngine.AI.NavMeshObstacle&gt;(selectionRect, go, colorNav, ref index, ref style);

        // Network
        DrawRectIcon&lt;NetworkIdentity&gt;(selectionRect, go, colorNetwork, ref index, ref style);
        DrawRectIcon&lt;NetworkAnimator&gt;(selectionRect, go, colorNetwork, ref index, ref style);
        DrawRectIcon&lt;NetworkTransform&gt;(selectionRect, go, colorNetwork, ref index, ref style);
        DrawRectIcon&lt;NetworkBehaviour&gt;(selectionRect, go, colorNetwork, ref index, ref style);
        DrawRectIcon&lt;NetworkManager&gt;(selectionRect, go, colorNetwork, ref index, ref style);

        // Particle
        DrawRectIcon&lt;ParticleSystem&gt;(selectionRect, go, colorParticle, ref index, ref style);

        // Audio
        DrawRectIcon&lt;AudioSource&gt;(selectionRect, go, colorAudio, ref index, ref style);
        DrawRectIcon&lt;AudioReverbZone&gt;(selectionRect, go, colorAudio, ref index, ref style);
        //UI
        DrawRectIcon&lt;Image&gt;(selectionRect, go, colorParticle, ref index, ref style);
        DrawRectIcon&lt;Text&gt;(selectionRect, go, colorParticle, ref index, ref style);

        DrawRectIcon&lt;SpriteRenderer&gt;(selectionRect, go, colorParticle, ref index, ref style);

        // 绘制Label来覆盖原有的名字
        if (style != null &amp;&amp; go.activeInHierarchy)
        {
            GUI.Label(selectionRect, go.name, style);
        }
    }

    private static void Update()
    {
        Debug.Log(&quot;1&quot;);
    }

    private static Rect GetRect(Rect selectionRect , int index)
    {
        Rect rect = new Rect(selectionRect);
        rect.x += rect.width - 20 - (20 * index);
        rect.width = 18;
        return rect;
    }

    /// &lt;summary&gt;
    /// 绘制一个Unity原声图标
    /// &lt;/summary&gt;
    /// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;
    /// &lt;param name=&quot;rect&quot;&gt;&lt;/param&gt;
    private static void DrawIcon&lt;T&gt;(Rect rect)
    {
        var icon = EditorGUIUtility.ObjectContent(null, typeof(T)).image;
        GUI.Label(rect, icon);
    }

    private static void DrawRectIcon&lt;T&gt;(Rect selectionRect,GameObject go,Color textColor,ref int order, ref GUIStyle style)where T :Component
    {
        if (go.HasComponent&lt;T&gt;())
        {
            order += 1;
            var rect = GetRect(selectionRect, order);
            DrawIcon&lt;T&gt;(rect);
        }
    }

    private static void DrawRectIcon(Rect selectionRect,Texture2D texture,ref int order)
    {
        order += 1;
        var rect = GetRect(selectionRect,order);
        GUI.Label(rect,texture);
    }
}

public static class ExtensionMethods
{
    public static bool HasComponent&lt;T&gt;(this GameObject go) where T : Component
    {
        return go.GetComponent&lt;T&gt;() != null;
    }
}
</code></pre><p>其中使用了[InitializeOnLoad]，这个Attribute的意思是在启动Unity的时候运行的编辑器脚本，该类需要一个静态的构造函数。。</p>
<p>通过EditorGUIUtility.ObjectContent(null,<br>typeof(T)).image就可以获取到T类型的Unity原声Texture了。<br>而Label和Toggle，则分别使用GUI.Label和GUI.Toggle即可。。具体参见上面代码。</p>
<p>我们可以根据需要定制自己需要的Hierarchy面板，例如上述代码中通过判断该GameObject是否是static的，如果是，则绘制一个S在旁边，这样就可以很快速的查看哪些物体是static的了。。</p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2017/09/02/Unity编辑器拓展之二：ReorderableList可重新排序的列表框（复杂使用）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/02/Unity编辑器拓展之二：ReorderableList可重新排序的列表框（复杂使用）/" class="post-title-link" itemprop="url">Unity编辑器拓展之二：ReorderableList可重新排序的列表框（复杂使用）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-09-02 16:07:25" itemprop="dateCreated datePublished" datetime="2017-09-02T16:07:25+08:00">2017-09-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:03:40" itemprop="dateModified" datetime="2019-03-11T22:03:40+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/09/02/Unity编辑器拓展之二：ReorderableList可重新排序的列表框（复杂使用）/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之二：ReorderableList可重新排序的列表框（复杂使用）">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<p>先看效果gif图：<br><img src="https://img-blog.csdn.net/20170902160043794?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>如果没有看过Unity编辑器拓展之一：ReorderableList可重新排序的列表框（简单使用）的，可以先看这一篇：<br><a href="http://blog.csdn.net/qq_26999509/article/details/77782177" target="_blank" rel="noopener"> http://blog.csdn.net/qq_26999509/article/details/77782177</a></p>
<p>在此基础上，来绘制更加复杂的类</p>
<p>先提供一个需要绘制的类</p>
<pre><code>using UnityEngine;
using System.Collections;
using System.Collections.Generic;
using System;

public class CharacterTest : MonoBehaviour 
{
    public List&lt;Character&gt; characters = new List&lt;Character&gt;();
    // Use this for initialization
    void Start () 
    {

    }

    // Update is called once per frame
    void Update () 
    {

    }
}

[Serializable]
public class Character
{
    [SerializeField]
    Texture icon;

    [SerializeField]
    string name;

    [SerializeField]
    int hp;

    [SerializeField]
    int power;

    [SerializeField]
    GameObject weapon;
}
</code></pre><p>然后跟上一篇一样，通过使用ReorderableList绘制List</p>
<pre><code>using UnityEngine;
using System.Collections;
using UnityEditor;
using UnityEditorInternal;

[CustomEditor(typeof(CharacterTest))]
public class CharacterInspector : Editor 
{
    ReorderableList reorderableList;

    void OnEnable()
    {
        SerializedProperty prop = serializedObject.FindProperty(&quot;characters&quot;);

        reorderableList = new ReorderableList(serializedObject, prop, true, true, true, true);

        //设置单个元素的高度
        reorderableList.elementHeight = 80;

        //绘制单个元素
        reorderableList.drawElementCallback =
            (rect, index, isActive, isFocused) =&gt; {
                var element = prop.GetArrayElementAtIndex(index);
                rect.height -= 4;
                rect.y += 2;
                EditorGUI.PropertyField(rect, element);
            };

        //背景色
        reorderableList.drawElementBackgroundCallback = (rect, index, isActive, isFocused) =&gt; {
            GUI.backgroundColor = Color.yellow;
        };

        //头部
        reorderableList.drawHeaderCallback = (rect) =&gt;
            EditorGUI.LabelField(rect, prop.displayName);

    }

    public override void OnInspectorGUI()
    {
        serializedObject.Update();
        reorderableList.DoLayoutList();
        serializedObject.ApplyModifiedProperties();
    }
}
</code></pre><p>目前的效果如下图：</p>
<p><img src="https://img-blog.csdn.net/20170902160317066?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>最后还需要利用PropertyDrawer来绘制单个Serializable类的每个实例的GUI，也就是Character类</p>
<pre><code>using UnityEngine;
using System.Collections;
using UnityEditor;

//定制Serializable类的每个实例的GUI
[CustomPropertyDrawer(typeof(Character))]
public class CharacterDrawer : PropertyDrawer 
{
    public override void OnGUI(Rect position, SerializedProperty property, GUIContent label)
    {
        //创建一个属性包装器，用于将常规GUI控件与SerializedProperty一起使用
        using (new EditorGUI.PropertyScope(position, label, property))
        {
            //设置属性名宽度 Name HP
            EditorGUIUtility.labelWidth = 60;
            //输入框高度，默认一行的高度
            position.height = EditorGUIUtility.singleLineHeight;

            //ico 位置矩形
            Rect iconRect = new Rect(position)
            {
                width = 68,
                height = 68
            };

            Rect nameRect = new Rect(position)
            {
                width = position.width - 70,    //减去icon的width 64
                x = position.x + 70             //在icon的基础上右移64
            };

            Rect hpRect = new Rect(nameRect)
            {
                //在name的基础上，y坐标下移
                y = nameRect.y + EditorGUIUtility.singleLineHeight + 2
            };

            Rect powerRect = new Rect(hpRect)
            {
                //在hp的基础上，y坐标下移
                y = hpRect.y + EditorGUIUtility.singleLineHeight + 2
            };

            Rect weaponLabelRect = new Rect(powerRect)
            {
                y = powerRect.y + EditorGUIUtility.singleLineHeight + 2,
                width = 60
            };

            Rect weaponRect = new Rect(weaponLabelRect)
            {
                x = weaponLabelRect.x + 60,
                width = powerRect.width - 60
            };

            //找到每个属性的序列化值
            SerializedProperty iconProperty = property.FindPropertyRelative(&quot;icon&quot;);
            SerializedProperty nameProperty = property.FindPropertyRelative(&quot;name&quot;);
            SerializedProperty hpProperty = property.FindPropertyRelative(&quot;hp&quot;);
            SerializedProperty powerProperty = property.FindPropertyRelative(&quot;power&quot;);
            SerializedProperty weaponProperty = property.FindPropertyRelative(&quot;weapon&quot;);

            //绘制icon
            iconProperty.objectReferenceValue = EditorGUI.ObjectField(iconRect, iconProperty.objectReferenceValue, typeof(Texture), false);

            //绘制name
            nameProperty.stringValue = EditorGUI.TextField(nameRect, nameProperty.displayName, nameProperty.stringValue);

            //Slider，范围在0-100
            EditorGUI.IntSlider(hpRect, hpProperty, 0, 100);
            //Slider，范围在0-10
            EditorGUI.IntSlider(powerRect, powerProperty, 0, 10);

            EditorGUI.PrefixLabel(weaponLabelRect, new GUIContent(&quot;weapon&quot;));
            EditorGUI.PropertyField(weaponRect, weaponProperty, GUIContent.none);
        }
    }
}
</code></pre><p>最后效果就是文章一开始的gif图了</p>
<p>示例工程链接：<br>链接： <a href="http://pan.baidu.com/s/1cgyZ98" target="_blank" rel="noopener"> http://pan.baidu.com/s/1cgyZ98 </a> 密码：jbzh</p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2017/09/01/Unity编辑器拓展之一：ReorderableList可重新排序的列表框（简单使用）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/09/01/Unity编辑器拓展之一：ReorderableList可重新排序的列表框（简单使用）/" class="post-title-link" itemprop="url">Unity编辑器拓展之一：ReorderableList可重新排序的列表框（简单使用）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-09-01 23:28:46" itemprop="dateCreated datePublished" datetime="2017-09-01T23:28:46+08:00">2017-09-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:05:00" itemprop="dateModified" datetime="2019-03-11T22:05:00+08:00">2019-03-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unity编辑器拓展/" itemprop="url" rel="index"><span itemprop="name">Unity编辑器拓展</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/2017/09/01/Unity编辑器拓展之一：ReorderableList可重新排序的列表框（简单使用）/" class="leancloud_visitors" data-flag-title="Unity编辑器拓展之一：ReorderableList可重新排序的列表框（简单使用）">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<h1 id="可重新排序的列表框"><a href="#可重新排序的列表框" class="headerlink" title="可重新排序的列表框"></a>可重新排序的列表框</h1><p>先看效果图：<br><img src="https://img-blog.csdn.net/20170901231522594?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>UnityEditorInternal命名空间下提供 一个类ReorderableList可以实现通过拖曳来达到列表元素的重新排序。</p>
<p>基本使用：<br>名称 描述<br>draggable 拖曳排序<br>displayAdd 显示添加按钮<br>displayRemove 显示移除按钮<br>elementHeight 元素高度<br>headerHeight 表头高度<br>footerHeight 尾部高度<br>showDefaultBackground 显示默认背景<br>drawHeaderCallback 绘制表头回调<br>drawFooterCallback 绘制尾部回调<br>drawElementCallback 绘制元素回调<br>drawElementBackgroundCallback 绘制元素背景回调<br>onReorderCallback 重新排序回调<br>onSelectCallback 选中回调<br>onAddCallback 添加按钮回调<br>onAddDropdownCallback 添加下拉选项回调<br>onRemoveCallback 移除元素回调<br>onMouseUpCallback 鼠标抬起回调<br>onCanRemoveCallback 是否显示可移除按钮回调<br>onChangedCallback 列表改变回调</p>
<p>示例代码如下：<br>先创建一个脚本：TestList</p>
<pre><code>using UnityEngine;
using System.Collections;
using System.Collections.Generic;

public class TestList : MonoBehaviour 
{
    public List&lt;Color&gt; m_colors = new List&lt;Color&gt;();

    private void Start()
    {

    }
}
</code></pre><p>上述代码中有一个List类型的变量，接下来使用一个继承自Editor脚本实现主要逻辑</p>
<pre><code>using UnityEngine;
using System.Collections;
using UnityEditor;
using UnityEditorInternal;
using System;

[CustomEditor(typeof(TestList))]
public class TestListEditor : Editor 
{
    private ReorderableList m_colors;
    private void OnEnable()
    {
        m_colors = new ReorderableList(serializedObject, serializedObject.FindProperty(&quot;m_colors&quot;), true, true, true, true);
        //绘制元素
        m_colors.drawElementCallback = (Rect rect, int index, bool selected, bool focused) =&gt;
        {
            SerializedProperty itemData = m_colors.serializedProperty.GetArrayElementAtIndex(index);
            rect.y += 2;
            rect.height = EditorGUIUtility.singleLineHeight;
            EditorGUI.PropertyField(rect, itemData, GUIContent.none);
        };
        //绘制表头
        m_colors.drawHeaderCallback = (Rect rect) =&gt;
        {
            GUI.Label(rect, &quot;Colors&quot;);
        };
        //当移除元素时回调
        m_colors.onRemoveCallback = (ReorderableList list) =&gt;
        {
            //弹出一个对话框
            if (EditorUtility.DisplayDialog(&quot;警告&quot;,&quot;是否确定删除该颜色&quot;,&quot;是&quot;,&quot;否&quot;))
            {
                //当点击“是”
                ReorderableList.defaultBehaviours.DoRemoveButton(list);
            }
        };
        //添加按钮回调
        m_colors.onAddCallback = (ReorderableList list) =&gt;
        {
            if (list.serializedProperty != null)
            {
                list.serializedProperty.arraySize++;
                list.index = list.serializedProperty.arraySize - 1;
                SerializedProperty itemData = list.serializedProperty.GetArrayElementAtIndex(list.index);
                itemData.colorValue = Color.red;
            }
            else
            {
                ReorderableList.defaultBehaviours.DoAddButton(list);
            }
        };
        //鼠标抬起回调
        m_colors.onMouseUpCallback = (ReorderableList list) =&gt;
        {
            Debug.Log(&quot;MouseUP&quot;);
        };
        //当选择元素回调
        m_colors.onSelectCallback = (ReorderableList list) =&gt;
        {
            //打印选中元素的索引
            Debug.Log(list.index);
        };
    }

    public override void OnInspectorGUI()
    {
        EditorGUILayout.Space();
        serializedObject.Update();
        m_colors.DoLayoutList();
        serializedObject.ApplyModifiedProperties();
    }
}
</code></pre><p>结果就如之前的图中显示所示。</p>
<p>其中OnInspectorGUI函数中，删除了base.OnInspectorGUI();<br>不然的话，效果如下图：<br><img src="https://img-blog.csdn.net/20170901232457862?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>可以看出，colors绘制了两遍。</p>
<p>示例工程链接：<br>链接： <a href="http://pan.baidu.com/s/1o7Tjslc" target="_blank" rel="noopener"> http://pan.baidu.com/s/1o7Tjslc </a><br>密码：pgri</p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jingfengji.github.io/2017/08/20/Unity之图片轮播组件实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Ding">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JingFengJi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/08/20/Unity之图片轮播组件实现/" class="post-title-link" itemprop="url">Unity之图片轮播组件实现</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-08-20 23:07:12" itemprop="dateCreated datePublished" datetime="2017-08-20T23:07:12+08:00">2017-08-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-11 22:05:18" itemprop="dateModified" datetime="2019-03-11T22:05:18+08:00">2019-03-11</time>
              
            
          </span>

          

          
            
            
          

          
          
            <span id="/2017/08/20/Unity之图片轮播组件实现/" class="leancloud_visitors" data-flag-title="Unity之图片轮播组件实现">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">Views: </span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <meta name="referrer" content="no-referrer">

<p>游戏中有时候会见到图片轮播的效果，那么这里就自己封装了一个，包括自动轮播、切页按钮控制、页码下标更新、滑动轮播、切页后的回调等等<br>下面，先上一个简陋的gif动态效果图</p>
<p><img src="https://img-blog.csdn.net/20170820225254127?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjY5OTk1MDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>从图中可以看出，该示例包括了三张图片的轮播，左右分别是上一张和下一张的按钮，右下角显示了当前是第几章的页码下标。</p>
<p>直接上脚本：</p>
<pre><code>using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.EventSystems;
using UnityEngine.UI;

namespace UnityEngine.UI
{
    [AddComponentMenu(&quot;UI/Slidershow&quot;, 39)]          //添加菜单
    [ExecuteInEditMode]                             //编辑模式下可执行
    [DisallowMultipleComponent]                     //不可重复
    [RequireComponent(typeof(RectTransform))]       //依赖于RectTransform组件
    public class Slideshow : UIBehaviour,IPointerDownHandler,IPointerUpHandler
    {
        public enum MovementType
        {
            /// &lt;summary&gt;
            /// 循环
            /// &lt;/summary&gt;
            Circulation,        //循环，轮播到最后一页之后，直接回到第一页

            /// &lt;summary&gt;
            /// 来回往复
            /// &lt;/summary&gt;
            PingPong,           //来回往复，轮播到最后一页之后，倒序轮播，到第一页之后，同理
        }

        public enum MoveDir
        {
            Left,
            Right,
        }

        [SerializeField]
        private MovementType m_movement = MovementType.Circulation;
        public MovementType Movement { get { return m_movement; } set { m_movement = value; } }

        [SerializeField]
        private RectTransform m_content;
        public RectTransform Content { get { return m_content; } set { m_content = value; } }

        [SerializeField]
        private Button m_lastPageButton;
        public Button LastPageButton { get { return m_lastPageButton; } set { m_lastPageButton = value; } }

        [SerializeField]
        private Button m_nextPageButton;
        public Button NextPageButton { get { return m_nextPageButton; } set { m_nextPageButton = value; } }

        /// &lt;summary&gt;
        /// 自动轮播时长
        /// &lt;/summary&gt;
        [SerializeField]
        private float m_showTime = 2.0f;
        public float ShowTime { get { return m_showTime; } set { m_showTime = value; } }

        /// &lt;summary&gt;
        /// 是否自动轮播
        /// &lt;/summary&gt;
        [SerializeField]
        private bool m_autoSlide = false;
        public bool AutoSlide { get { return m_autoSlide; }set { m_autoSlide = value; } }

        /// &lt;summary&gt;
        /// 自动轮播方向，-1表示向左，1表示向右
        /// &lt;/summary&gt;
        private MoveDir m_autoSlideDir = MoveDir.Right;

        /// &lt;summary&gt;
        /// 是否允许拖动切页
        /// &lt;/summary&gt;
        [SerializeField]
        private bool m_allowDrag = true;
        public bool AllowDrag { get { return m_allowDrag; }set { m_allowDrag = value; } }

        /// &lt;summary&gt;
        /// 当前显示页的页码，下标从0开始
        /// &lt;/summary&gt;
        private int m_curPageIndex = 0;
        public int CurPageIndex { get { return m_curPageIndex; } }

        /// &lt;summary&gt;
        /// 最大页码
        /// &lt;/summary&gt;
        private int m_maxPageIndex = 0;
        public int MaxPageIndex { get { return m_maxPageIndex; } }

        /// &lt;summary&gt;
        /// 圆圈页码ToggleGroup
        /// &lt;/summary&gt;
        [SerializeField]
        private ToggleGroup m_pageToggleGroup;
        public ToggleGroup PageToggleGroup { get { return m_pageToggleGroup; } set { m_pageToggleGroup = value; } }

        /// &lt;summary&gt;
        /// 圆圈页码Toggle List
        /// &lt;/summary&gt;
        private List&lt;Toggle&gt; m_pageToggleList;
        public List&lt;Toggle&gt; PageToggleLise { get { return m_pageToggleList; }}

        //item数目
        private int m_itemNum = 0;
        public int ItemNum { get { return m_itemNum; } }

        //以Toggle为Key，返回页码
        private Dictionary&lt;Toggle, int&gt; m_togglePageNumDic = null;

        private float m_time = 0f;

        private List&lt;float&gt; m_childItemPos = new List&lt;float&gt;();

        private GridLayoutGroup m_grid = null;

        protected override void Awake()
        {
            base.Awake();
            if (null == m_content)
            {
                throw new Exception(&quot;Slideshow content is null&quot;);
            }
            else
            {
                m_grid = m_content.GetComponent&lt;GridLayoutGroup&gt;();
                if (m_grid == null)
                {
                    throw new Exception(&quot;Slideshow content is miss GridLayoutGroup Component&quot;);
                }
                InitChildItemPos();
            }


            if (null != m_lastPageButton)
            {
                m_lastPageButton.onClick.AddListener(OnLastPageButtonClick);
            }
            if (null != m_nextPageButton)
            {
                m_nextPageButton.onClick.AddListener(OnNextPageButtonClick);
            }
            if (null != m_pageToggleGroup)
            {
                int toggleNum = m_pageToggleGroup.transform.childCount;
                if (toggleNum &gt; 0)
                {
                    m_pageToggleList = new List&lt;Toggle&gt;();
                    m_togglePageNumDic = new Dictionary&lt;Toggle, int&gt;();
                    for (int i = 0; i &lt; toggleNum; i++)
                    {
                        Toggle childToggle = m_pageToggleGroup.transform.GetChild(i).GetComponent&lt;Toggle&gt;();
                        if (null != childToggle)
                        {
                            m_pageToggleList.Add(childToggle);
                            m_togglePageNumDic.Add(childToggle, i);
                            childToggle.onValueChanged.AddListener(OnPageToggleValueChanged);
                        }
                    }
                    m_itemNum = m_pageToggleList.Count;
                    m_maxPageIndex = m_pageToggleList.Count - 1;
                }
            }
            UpdateCutPageButtonActive(m_curPageIndex);
        }

        private void InitChildItemPos()
        {
            int childCount = m_content.transform.childCount;
            float cellSizeX = m_grid.cellSize.x;
            float spacingX = m_grid.spacing.x;
            float posX = -cellSizeX * 0.5f;
            m_childItemPos.Add(posX);
            for (int i = 1; i &lt; childCount; i++)
            {
                posX -= cellSizeX + spacingX;
                m_childItemPos.Add(posX);
            }
        }

        private void OnPageToggleValueChanged(bool ison)
        {
            if (ison)
            {
                Toggle activeToggle = GetActivePageToggle();
                if (m_togglePageNumDic.ContainsKey(activeToggle))
                {
                    int page = m_togglePageNumDic[activeToggle];
                    SwitchToPageNum(page);
                }
            }
        }

        private Toggle GetActivePageToggle()
        {
            if (m_pageToggleGroup == null || m_pageToggleList == null || m_pageToggleList.Count &lt;= 0)
            {
                return null;
            }
            for (int i = 0; i &lt; m_pageToggleList.Count; i++)
            {
                if (m_pageToggleList[i].isOn)
                {
                    return m_pageToggleList[i];
                }
            }
            return null;
        }

        /// &lt;summary&gt;
        /// 切换至某页
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;pageNum&quot;&gt;页码&lt;/param&gt;
        private void SwitchToPageNum(int pageNum)
        {
            if (pageNum &lt; 0 || pageNum &gt; m_maxPageIndex)
            {
                throw new Exception(&quot;page num is error&quot;);
            }
            if (pageNum == m_curPageIndex)
            {
                //目标页与当前页是同一页
                return;
            }
            m_curPageIndex = pageNum;
            if (m_movement == MovementType.PingPong)
            {
                UpdateCutPageButtonActive(m_curPageIndex);
            }
            Vector3 pos = m_content.localPosition;
            m_content.localPosition = new Vector3(m_childItemPos[m_curPageIndex], pos.y, pos.z);
            m_pageToggleList[m_curPageIndex].isOn = true;

            if (m_onValueChanged != null)
            {
                //执行回调
                m_onValueChanged.Invoke(m_pageToggleList[m_curPageIndex].gameObject);
            }
        }

        /// &lt;summary&gt;
        /// 根据页码更新切页按钮active
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;pageNum&quot;&gt;&lt;/param&gt;
        private void UpdateCutPageButtonActive(int pageNum)
        {
            if (pageNum == 0)
            {
                UpdateLastButtonActive(false);
                UpdateNextButtonActive(true);
            }
            else if (pageNum == m_maxPageIndex)
            {
                UpdateLastButtonActive(true);
                UpdateNextButtonActive(false);
            }
            else
            {
                UpdateLastButtonActive(true);
                UpdateNextButtonActive(true);
            }
        }

        private void OnNextPageButtonClick()
        {
            m_time = Time.time;     //重新计时
            switch (m_movement)
            {
                case MovementType.Circulation:
                    SwitchToPageNum((m_curPageIndex + 1) % m_itemNum);
                    break;
                case MovementType.PingPong:
                    //该模式下，会自动隐藏切页按钮
                    SwitchToPageNum(m_curPageIndex + 1);
                    break;
                default:
                    break;
            }
            Debug.Log(m_content.localPosition);
        }

        private void OnLastPageButtonClick()
        {
            m_time = Time.time; //重新计时
            switch (m_movement)
            {
                case MovementType.Circulation:
                    SwitchToPageNum((m_curPageIndex + m_itemNum - 1) % m_itemNum);
                    break;
                case MovementType.PingPong:
                    //该模式下，会自动隐藏切页按钮
                    SwitchToPageNum(m_curPageIndex - 1);
                    break;
                default:
                    break;
            }
        }

        private void UpdateLastButtonActive(bool activeSelf)
        {
            if (null == m_lastPageButton)
            {
                throw new Exception(&quot;Last Page Button is null&quot;);
            }
            bool curActive = m_lastPageButton.gameObject.activeSelf;
            if (curActive != activeSelf)
            {
                m_lastPageButton.gameObject.SetActive(activeSelf);
            }
        }

        private void UpdateNextButtonActive(bool activeSelf)
        {
            if (null == m_nextPageButton)
            {
                throw new Exception(&quot;Next Page Button is null&quot;);
            }
            bool curActive = m_nextPageButton.gameObject.activeSelf;
            if (curActive != activeSelf)
            {
                m_nextPageButton.gameObject.SetActive(activeSelf);
            }
        }

        private Vector3 m_originDragPos = Vector3.zero;
        private Vector3 m_desDragPos = Vector3.zero;
        private bool m_isDrag = false;

        public void OnPointerDown(PointerEventData eventData)
        {
            if (!m_allowDrag)
            {
                return;
            }
            if (eventData.button != PointerEventData.InputButton.Left)
            {
                return;
            }
            if (!IsActive())
            {
                return;
            }

            m_isDrag = true;
            m_originDragPos = eventData.position;
        }

        public void OnPointerUp(PointerEventData eventData)
        {
            m_desDragPos = eventData.position;
            MoveDir dir = MoveDir.Right;
            if (m_desDragPos.x &lt; m_originDragPos.x)
            {
                dir = MoveDir.Left;
            }
            switch (dir)
            {
                case MoveDir.Left:
                    if (m_movement == MovementType.Circulation || (m_movement == MovementType.PingPong &amp;&amp; m_curPageIndex != 0))
                    {
                        OnLastPageButtonClick();
                    }

                    break;
                case MoveDir.Right:
                    if (m_movement == MovementType.Circulation || (m_movement == MovementType.PingPong &amp;&amp; m_curPageIndex != m_maxPageIndex))
                    {
                        OnNextPageButtonClick();
                    }
                    break;
            }
            m_isDrag = false;
        }

        /// &lt;summary&gt;
        /// 切页后回调函数
        /// &lt;/summary&gt;
        [Serializable]
        public class SlideshowEvent : UnityEvent&lt;GameObject&gt; { }

        [SerializeField]
        private SlideshowEvent m_onValueChanged = new SlideshowEvent();
        public SlideshowEvent OnValueChanged { get { return m_onValueChanged; } set { m_onValueChanged = value; } }

        public override bool IsActive()
        {
            return base.IsActive() &amp;&amp; m_content != null;
        }

        private void Update()
        {
            if (m_autoSlide &amp;&amp; !m_isDrag)
            {
                if (Time.time &gt; m_time + m_showTime)
                {
                    m_time = Time.time;
                    switch (m_movement)
                    {
                        case MovementType.Circulation:
                            m_autoSlideDir = MoveDir.Right;
                            break;
                        case MovementType.PingPong:
                            if (m_curPageIndex == 0)
                            {
                                m_autoSlideDir = MoveDir.Right;
                            }
                            else if (m_curPageIndex == m_maxPageIndex)
                            {
                                m_autoSlideDir = MoveDir.Left;
                            }
                            break;
                    }
                    switch (m_autoSlideDir)
                    {
                        case MoveDir.Left:
                            OnLastPageButtonClick();
                            break;
                        case MoveDir.Right:
                            OnNextPageButtonClick();
                            break;
                    }
                }
            }
        }
    }
}
</code></pre><p>这里提供了一个枚举MovementType，该枚举定义了两种循环方式，其中Circulation循环，是指轮播到最后一页之后，直接回到第一页；而PingPong相信大家你熟悉了，就是来回往复的。</p>
<p>其中还提供了对每张图显示的时长进行设置，还有是否允许自动轮播的控制，是否允许拖动切页控制，等等。。其实将图片作为轮播子元素只是其中之一而已，完全可以将ScrollRect作为轮播子元素，这样每个子元素又可以滑动阅览了。。</p>
<p>这里还提供了两个编辑器脚本，一个是SlideshowEditor（依赖Slideshow组件），另一个是给用户提供菜单用的CreateSlideshow，代码分别如下：</p>
<pre><code>using System.Collections;
using System.Collections.Generic;
using UnityEditor;
using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;

public class CreateSlideshow : Editor
{
    private static GameObject m_slideshowPrefab = null;

    private static GameObject m_canvas = null;

    [MenuItem(&quot;GameObject/UI/Slideshow&quot;)]
    static void CreateSlideshowUI(MenuCommand menuCommand)
    {
        if (null == m_slideshowPrefab)
        {
            m_slideshowPrefab = Resources.Load&lt;GameObject&gt;(&quot;Slideshow&quot;);
            if (null == m_slideshowPrefab)
            {
                Debug.LogError(&quot;Prefab Slideshow is null&quot;);
                return;
            }
        }

        m_canvas = menuCommand.context as GameObject;
        if (m_canvas == null || m_canvas.GetComponentInParent&lt;Canvas&gt;() == null)
        {
            m_canvas = GetOrCreateCanvasGameObject();
        }

        GameObject go = GameObject.Instantiate(m_slideshowPrefab, m_canvas.transform);
        go.transform.localPosition = Vector3.zero;
        go.name = &quot;Slideshow&quot;;
        Selection.activeGameObject = go;
    }

    static public GameObject GetOrCreateCanvasGameObject()
    {
        GameObject selectedGo = Selection.activeGameObject;

        Canvas canvas = (selectedGo != null) ? selectedGo.GetComponentInParent&lt;Canvas&gt;() : null;
        if (canvas != null &amp;&amp; canvas.gameObject.activeInHierarchy)
            return canvas.gameObject;

        canvas = Object.FindObjectOfType(typeof(Canvas)) as Canvas;
        if (canvas != null &amp;&amp; canvas.gameObject.activeInHierarchy)
            return canvas.gameObject;

        return CreateCanvas();
    }

    public static GameObject CreateCanvas()
    {
        var root = new GameObject(&quot;Canvas&quot;);
        root.layer = LayerMask.NameToLayer(&quot;UI&quot;);
        Canvas canvas = root.AddComponent&lt;Canvas&gt;();
        canvas.renderMode = RenderMode.ScreenSpaceOverlay;
        root.AddComponent&lt;CanvasScaler&gt;();
        root.AddComponent&lt;GraphicRaycaster&gt;();
        Undo.RegisterCreatedObjectUndo(root, &quot;Create &quot; + root.name);

        CreateEventSystem();
        return root;
    }

    public static void CreateEventSystem()
    {
        var esys = Object.FindObjectOfType&lt;EventSystem&gt;();
        if (esys == null)
        {
            var eventSystem = new GameObject(&quot;EventSystem&quot;);
            GameObjectUtility.SetParentAndAlign(eventSystem, null);
            esys = eventSystem.AddComponent&lt;EventSystem&gt;();
            eventSystem.AddComponent&lt;StandaloneInputModule&gt;();

            Undo.RegisterCreatedObjectUndo(eventSystem, &quot;Create &quot; + eventSystem.name);
        }
    }
}



using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEditor.Advertisements;
using UnityEngine.UI;

namespace UnityEditor.UI
{
    [CustomEditor(typeof(Slideshow), true)]
    public class SlideshowEditor : Editor
    {
        SerializedProperty m_movement;
        SerializedProperty m_content;
        SerializedProperty m_lastPageButton;
        SerializedProperty m_nextPageButton;
        SerializedProperty m_showTime;
        SerializedProperty m_pageToggleGroup;
        SerializedProperty m_onValueChanged;
        SerializedProperty m_allowDrag;
        SerializedProperty m_autoSlide;

        protected virtual void OnEnable()
        {
            m_movement = serializedObject.FindProperty(&quot;m_movement&quot;);
            m_content = serializedObject.FindProperty(&quot;m_content&quot;);
            m_lastPageButton = serializedObject.FindProperty(&quot;m_lastPageButton&quot;);
            m_nextPageButton = serializedObject.FindProperty(&quot;m_nextPageButton&quot;);
            m_showTime = serializedObject.FindProperty(&quot;m_showTime&quot;);
            m_pageToggleGroup = serializedObject.FindProperty(&quot;m_pageToggleGroup&quot;);
            m_onValueChanged = serializedObject.FindProperty(&quot;m_onValueChanged&quot;);
            m_allowDrag = serializedObject.FindProperty(&quot;m_allowDrag&quot;);
            m_autoSlide = serializedObject.FindProperty(&quot;m_autoSlide&quot;);
        }

        public override void OnInspectorGUI()
        {
            serializedObject.Update();
            EditorGUILayout.PropertyField(m_movement);
            EditorGUILayout.PropertyField(m_content);
            EditorGUILayout.PropertyField(m_lastPageButton);
            EditorGUILayout.PropertyField(m_nextPageButton);
            EditorGUILayout.PropertyField(m_allowDrag);
            EditorGUILayout.PropertyField(m_autoSlide);
            EditorGUILayout.PropertyField(m_showTime);
            EditorGUILayout.PropertyField(m_pageToggleGroup);
            EditorGUILayout.Space();
            EditorGUILayout.PropertyField(m_onValueChanged);

            //不加这句代码，在编辑模式下，无法将物体拖拽赋值
            serializedObject.ApplyModifiedProperties();
        }
    }
}
</code></pre><p>这两个脚本中使用了一些拓展编辑器的知识，后续在另外写博客介绍<br>其中脚本CreateSlideshow中使用UGUI源码中的DefaultControls脚本里的方法，有兴趣可以去下载查阅。<br>Demo工程下载地址如下：<br>链接： <a href="http://pan.baidu.com/s/1i4Rralf" target="_blank" rel="noopener"> http://pan.baidu.com/s/1i4Rralf </a><br>密码：7loe<br>链接如有私有，请及时联系补充</p>
<p>以上知识分享，如有错误，欢迎指出，共同学习，共同进步</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Mr.Ding</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">59</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.Ding</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>



  

  


  <script src="/js/src/bootstrap.js?v=7.0.1"></script>


  
  



  




  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'NNhaQgimB4QlP2E7VIp881se-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'NNhaQgimB4QlP2E7VIp881se-gzGzoHsz',
                'X-LC-Key': 'r32VGyBHt0lquCi8EGcIJlJN',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
